import { useState, useEffect } from "react";
import { Sun, Cloud, Droplets, CloudRain, CloudSnow, Wind, Thermometer, Compass, LocateFixed, Search, RefreshCw, Map, Settings } from "lucide-react";

// Main Weather App Component
export default function WeatherApp() {
  const [location, setLocation] = useState("Zerbst, DE");
  const [currentWeather, setCurrentWeather] = useState({
    temp: 21,
    condition: "Teilweise bewölkt",
    high: 24,
    low: 14,
    humidity: 65,
    wind: 12,
    uvIndex: 5,
    precipitation: 20,
  });
  const [activeTab, setActiveTab] = useState("hourly");
  const [showSearch, setShowSearch] = useState(false);
  const [geolocationStatus, setGeolocationStatus] = useState("");
  
  // Get the current date in German format
  const today = new Date();
  const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  const formattedDate = today.toLocaleDateString('de-DE', dateOptions);
  
  // Simulated hourly forecast data
  const hourlyForecast = [
    { time: "Jetzt", temp: 21, condition: "partly-cloudy" },
    { time: "14:00", temp: 22, condition: "sunny" },
    { time: "15:00", temp: 23, condition: "sunny" },
    { time: "16:00", temp: 23, condition: "sunny" },
    { time: "17:00", temp: 22, condition: "partly-cloudy" },
    { time: "18:00", temp: 21, condition: "partly-cloudy" },
    { time: "19:00", temp: 19, condition: "cloudy" },
    { time: "20:00", temp: 18, condition: "cloudy" },
    { time: "21:00", temp: 17, condition: "cloudy" },
    { time: "22:00", temp: 16, condition: "cloudy" },
    { time: "23:00", temp: 15, condition: "cloudy" },
    { time: "00:00", temp: 14, condition: "cloudy" },
  ];
  
  // Simulated daily forecast data
  const dailyForecast = [
    { day: "Heute", high: 24, low: 14, condition: "partly-cloudy" },
    { day: "Fr", high: 25, low: 15, condition: "sunny" },
    { day: "Sa", high: 26, low: 16, condition: "sunny" },
    { day: "So", high: 22, low: 14, condition: "rainy" },
    { day: "Mo", high: 19, low: 12, condition: "rainy" },
    { day: "Di", high: 20, low: 13, condition: "cloudy" },
    { day: "Mi", high: 22, low: 14, condition: "partly-cloudy" },
    { day: "Do", high: 23, low: 15, condition: "sunny" },
    { day: "Fr", high: 24, low: 16, condition: "sunny" },
    { day: "Sa", high: 25, low: 15, condition: "partly-cloudy" },
  ];
  
  // Recent locations for search panel
  const recentLocations = [
    { name: "Zerbst, Sachsen-Anhalt", temp: 21 },
    { name: "Berlin", temp: 22 },
    { name: "München", temp: 20 },
    { name: "Hamburg", temp: 19 },
    { name: "Köln", temp: 21 },
  ];
  
  // Get user's location
  const getUserLocation = () => {
    setGeolocationStatus("Standort wird abgerufen...");
    
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setGeolocationStatus("Standort erfolgreich erkannt!");
          // In a real app, you would reverse geocode the coordinates to get the city name
          // and then fetch weather data for that location
          
          // Simulate location change after a short delay
          setTimeout(() => {
            setGeolocationStatus("");
            setLocation("Ihr Standort");
          }, 1500);
        },
        (error) => {
          console.error("Geolocation error:", error);
          setGeolocationStatus("Standort konnte nicht abgerufen werden.");
          setTimeout(() => setGeolocationStatus(""), 3000);
        }
      );
    } else {
      setGeolocationStatus("Geolokalisierung wird von Ihrem Browser nicht unterstützt.");
      setTimeout(() => setGeolocationStatus(""), 3000);
    }
  };
  
  // Function to render weather icon based on condition
  const WeatherIcon = ({ condition, size = "md" }) => {
    const sizes = {
      sm: "w-8 h-8",
      md: "w-16 h-16",
      lg: "w-24 h-24",
    };
    
    const iconSize = sizes[size] || sizes.md;
    
    switch (condition) {
      case "sunny":
        return (
          <div className={`relative ${iconSize}`}>
            <Sun className="w-full h-full text-yellow-300" />
          </div>
        );
      case "partly-cloudy":
        return (
          <div className={`relative ${iconSize}`}>
            <Sun className="w-full h-full text-yellow-300 absolute" />
            <Cloud className="w-2/3 h-2/3 text-white opacity-90 absolute bottom-0 right-0" />
          </div>
        );
      case "cloudy":
        return (
          <div className={`relative ${iconSize}`}>
            <Cloud className="w-full h-full text-white" />
          </div>
        );
      case "rainy":
        return (
          <div className={`relative ${iconSize}`}>
            <Cloud className="w-full h-full text-gray-300" />
            <Droplets className="w-1/2 h-1/2 text-blue-400 absolute bottom-0 right-0" />
          </div>
        );
      case "stormy":
        return (
          <div className={`relative ${iconSize}`}>
            <CloudRain className="w-full h-full text-blue-400" />
          </div>
        );
      case "snowy":
        return (
          <div className={`relative ${iconSize}`}>
            <CloudSnow className="w-full h-full text-white" />
          </div>
        );
      default:
        return (
          <div className={`relative ${iconSize}`}>
            <Cloud className="w-full h-full text-white" />
          </div>
        );
    }
  };

  return (
    <div className="bg-black min-h-screen text-white flex flex-col">
      {/* Status Notification */}
      {geolocationStatus && (
        <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white py-2 px-4 rounded-lg z-50 shadow-lg">
          {geolocationStatus}
        </div>
      )}
      
      {/* Main Content */}
      <div className="max-w-6xl w-full mx-auto flex flex-col min-h-screen p-6">
        {/* Header */}
        <header className="flex justify-between items-center mb-6 pt-4">
          <div className="flex items-center gap-2">
            <LocateFixed className="text-blue-400 w-5 h-5" />
            <h1 className="text-2xl font-medium">{location}</h1>
            <button 
              onClick={getUserLocation} 
              className="ml-2 text-blue-400 hover:text-blue-300 transition-colors"
            >
              <LocateFixed className="w-4 h-4" />
            </button>
          </div>
          <div className="flex gap-2">
            <button 
              onClick={() => setShowSearch(true)}
              className="bg-gray-800 bg-opacity-75 p-2 rounded-lg hover:bg-gray-700 transition-colors"
            >
              <Search className="w-6 h-6" />
            </button>
            <button 
              className="bg-gray-800 bg-opacity-75 p-2 rounded-lg hover:bg-gray-700 transition-colors"
            >
              <RefreshCw className="w-6 h-6" />
            </button>
          </div>
        </header>

        {/* Desktop Layout - Two Column */}
        <div className="flex flex-1 gap-6">
          {/* Left Column - Current Weather & Detail */}
          <div className="flex-1">
            {/* Current Weather Card */}
            <div className="bg-gray-900 bg-opacity-75 rounded-2xl p-6 mb-6 border border-gray-800 shadow-lg">
              <div className="text-gray-400 text-sm mb-4">
                {formattedDate} · Aktualisiert vor 5 Min.
              </div>
              
              <div className="flex items-center mb-6">
                <div className="text-7xl font-light mr-6">{currentWeather.temp}°</div>
                <div className="flex flex-col items-center">
                  <WeatherIcon condition="partly-cloudy" size="lg" />
                  <div className="mt-2">{currentWeather.condition}</div>
                </div>
              </div>
              
              <div className="text-gray-400 mb-6">H: {currentWeather.high}° · T: {currentWeather.low}°</div>
              
              {/* Weather Details Grid */}
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex flex-col items-center">
                  <span className="text-gray-400 text-sm mb-1">Luftfeuchtigkeit</span>
                  <div className="flex items-center">
                    <Droplets className="w-5 h-5 text-blue-400 mr-2" />
                    <span className="text-lg text-blue-400">{currentWeather.humidity}%</span>
                  </div>
                </div>
                
                <div className="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex flex-col items-center">
                  <span className="text-gray-400 text-sm mb-1">Wind</span>
                  <div className="flex items-center">
                    <Wind className="w-5 h-5 text-blue-400 mr-2" />
                    <span className="text-lg text-blue-400">{currentWeather.wind} km/h</span>
                  </div>
                </div>
                
                <div className="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex flex-col items-center">
                  <span className="text-gray-400 text-sm mb-1">UV-Index</span>
                  <div className="flex items-center">
                    <Sun className="w-5 h-5 text-yellow-400 mr-2" />
                    <span className="text-lg text-yellow-400">{currentWeather.uvIndex}</span>
                  </div>
                </div>
                
                <div className="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex flex-col items-center">
                  <span className="text-gray-400 text-sm mb-1">Niederschlag</span>
                  <div className="flex items-center">
                    <CloudRain className="w-5 h-5 text-blue-400 mr-2" />
                    <span className="text-lg text-blue-400">{currentWeather.precipitation}%</span>
                  </div>
                </div>
              </div>

              {/* Extra details for desktop */}
              <div className="mt-6 p-4 bg-gray-800 bg-opacity-30 rounded-xl">
                <h3 className="text-lg mb-2">Weitere Details</h3>
                <div className="grid grid-cols-3 gap-4">
                  <div>
                    <p className="text-gray-400 text-sm">Luftdruck</p>
                    <p>1013 hPa</p>
                  </div>
                  <div>
                    <p className="text-gray-400 text-sm">Sichtweite</p>
                    <p>10 km</p>
                  </div>
                  <div>
                    <p className="text-gray-400 text-sm">Taupunkt</p>
                    <p>12°</p>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Radar Map Card - Desktop Only */}
            <div className="bg-gray-900 bg-opacity-75 rounded-2xl p-6 border border-gray-800 shadow-lg">
              <h3 className="text-lg mb-4">Wetterradar</h3>
              <div className="relative h-64 bg-blue-900 bg-opacity-20 rounded-xl overflow-hidden flex items-center justify-center">
                <div className="absolute inset-0 bg-[url('/api/placeholder/600/300')] opacity-40"></div>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span className="text-sm opacity-70">Hier würde eine Wetterkarte angezeigt werden</span>
                </div>
                <div className="absolute bottom-4 right-4 p-2 bg-black bg-opacity-50 rounded-lg">
                  <div className="flex items-center text-sm">
                    <span className="inline-block w-3 h-3 bg-blue-500 mr-1 rounded-full"></span>
                    <span className="mr-2">Regen</span>
                    <span className="inline-block w-3 h-3 bg-green-500 mr-1 rounded-full"></span>
                    <span>Niederschlag</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Right Column - Forecasts */}
          <div className="flex-1">
            {/* Tab Navigation */}
            <div className="bg-gray-800 bg-opacity-60 rounded-lg p-1 mb-6">
              <div className="flex">
                <button 
                  className={`flex-1 py-2 text-center rounded ${activeTab === "hourly" ? "bg-gray-700 text-white" : "text-gray-400"}`}
                  onClick={() => setActiveTab("hourly")}
                >
                  Stündlich
                </button>
                <button 
                  className={`flex-1 py-2 text-center rounded ${activeTab === "daily" ? "bg-gray-700 text-white" : "text-gray-400"}`}
                  onClick={() => setActiveTab("daily")}
                >
                  10 Tage
                </button>
              </div>
            </div>
            
            {/* Forecasts Panel */}
            <div className="bg-gray-900 bg-opacity-75 rounded-2xl p-6 border border-gray-800 shadow-lg min-h-96 mb-6">
              <h3 className="text-lg mb-4">{activeTab === "hourly" ? "Stündliche Vorhersage" : "10-Tage Vorhersage"}</h3>
              
              {activeTab === "hourly" ? (
                <div className="grid grid-cols-4 gap-4">
                  {hourlyForecast.map((forecast, index) => (
                    <div key={index} className="bg-gray-800 bg-opacity-50 rounded-xl p-3 flex flex-col items-center">
                      <div className="text-gray-400 text-sm mb-1">{forecast.time}</div>
                      <WeatherIcon condition={forecast.condition} size="sm" />
                      <div className="mt-2 font-medium">{forecast.temp}°</div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="flex flex-col gap-3">
                  {dailyForecast.map((forecast, index) => (
                    <div key={index} className="bg-gray-800 bg-opacity-50 rounded-xl p-3 flex items-center">
                      <div className="w-16 text-gray-100">{forecast.day}</div>
                      <div className="w-20 flex justify-center">
                        <WeatherIcon condition={forecast.condition} size="sm" />
                      </div>
                      <div className="flex-1"></div>
                      <div className="text-right flex gap-3 items-center">
                        <span className="text-blue-400">{forecast.low}°</span>
                        <div className="w-24 bg-gray-700 h-1 rounded-full overflow-hidden">
                          <div className="bg-gradient-to-r from-blue-400 to-yellow-400 h-full" style={{width: "70%"}}></div>
                        </div>
                        <span className="text-yellow-400">{forecast.high}°</span>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
            
            {/* Additional Information - Desktop Only */}
            <div className="bg-gray-900 bg-opacity-75 rounded-2xl p-6 border border-gray-800 shadow-lg">
              <h3 className="text-lg mb-4">Tagesüberblick</h3>
              <div className="grid grid-cols-2 gap-6">
                <div>
                  <p className="text-gray-400 text-sm mb-1">Sonnenaufgang</p>
                  <div className="flex items-center">
                    <Sun className="w-5 h-5 text-yellow-400 mr-2" />
                    <span>05:32</span>
                  </div>
                </div>
                <div>
                  <p className="text-gray-400 text-sm mb-1">Sonnenuntergang</p>
                  <div className="flex items-center">
                    <Sun className="w-5 h-5 text-orange-400 mr-2" />
                    <span>20:58</span>
                  </div>
                </div>
                <div>
                  <p className="text-gray-400 text-sm mb-1">Niederschlagswahrscheinlichkeit</p>
                  <div className="mt-1 h-3 bg-gray-700 rounded-full overflow-hidden">
                    <div className="bg-blue-400 h-full rounded-full" style={{ width: `${currentWeather.precipitation}%` }}></div>
                  </div>
                  <div className="flex justify-between text-xs mt-1">
                    <span>0%</span>
                    <span>50%</span>
                    <span>100%</span>
                  </div>
                </div>
                <div>
                  <p className="text-gray-400 text-sm mb-1">Luftqualität</p>
                  <div className="flex items-center gap-2">
                    <div className="h-3 w-3 rounded-full bg-green-400"></div>
                    <span>Gut (AQI: 32)</span>
                  </div>
                  <p className="text-xs text-gray-400 mt-1">Ideal für Aktivitäten im Freien</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        {/* Footer Navigation */}
        <footer className="mt-8 bg-gray-900 bg-opacity-75 rounded-2xl p-4 border border-gray-800 shadow-lg flex justify-between">
          <div className="flex items-center text-blue-400">
            <Thermometer className="w-6 h-6 mr-2" />
            <span>Wetter</span>
          </div>
          <div className="flex items-center text-gray-400 hover:text-white transition-colors cursor-pointer">
            <Map className="w-6 h-6 mr-2" />
            <span>Karte</span>
          </div>
          <div className="flex items-center text-gray-400 hover:text-white transition-colors cursor-pointer">
            <Compass className="w-6 h-6 mr-2" />
            <span>Radar</span>
          </div>
          <div className="flex items-center text-gray-400 hover:text-white transition-colors cursor-pointer">
            <Settings className="w-6 h-6 mr-2" />
            <span>Einstellungen</span>
          </div>
        </footer>
      </div>
      
      {/* Search Panel */}
      {showSearch && (
        <div className="fixed inset-0 bg-black bg-opacity-95 z-50 p-6 overflow-auto">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center mb-8">
              <button 
                onClick={() => setShowSearch(false)}
                className="text-3xl mr-4 text-white hover:text-gray-300 transition-colors"
              >
                &times;
              </button>
              <input 
                type="text" 
                className="flex-1 bg-gray-800 bg-opacity-75 border border-gray-700 rounded-lg text-white p-3 text-lg"
                placeholder="Stadt, PLZ oder Airport suchen..."
              />
            </div>
            
            <div className="mb-8">
              <h3 className="text-xl mb-4">Aktuelle Standorte</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {recentLocations.map((loc, index) => (
                  <div 
                    key={index}
                    className="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex justify-between items-center cursor-pointer hover:bg-gray-700 transition-colors"
                    onClick={() => {
                      setLocation(loc.name.split(',')[0]);
                      setShowSearch(false);
                    }}
                  >
                    <div className="location-name">{loc.name}</div>
                    <div className="text-xl font-medium">{loc.temp}°</div>
                  </div>
                ))}
              </div>
            </div>
            
            <div>
              <h3 className="text-xl mb-4">Standortdienste</h3>
              <button 
                onClick={() => {
                  getUserLocation();
                  setShowSearch(false);
                }}
                className="bg-blue-600 hover:bg-blue-500 text-white py-3 px-6 rounded-lg flex items-center transition-colors"
              >
                <LocateFixed className="w-5 h-5 mr-2" />
                Meinen aktuellen Standort verwenden
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
