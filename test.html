<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firefox Advanced Startseite</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Firefox Advanced Startpage">
    <meta name="description" content="Comprehensive Firefox startpage with widgets, weather, news, and productivity tools">
    <meta name="theme-color" content="#ff9500">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Startpage">
    <meta name="msapplication-TileColor" content="#ff9500">
    <meta name="msapplication-config" content="./browserconfig.xml">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iI2ZmOTUwMCIvPgo8cGF0aCBkPSJNMTYgNEM5LjM3IDQgNCA5LjM3IDQgMTZzNS4zNyAxMiAxMiAxMiAxMi01LjM3IDEyLTEyUzIyLjYzIDQgMTYgNHoiIGZpbGw9IiNmZmYiLz4KPC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjQiIGZpbGw9IiNmZjk1MDAiLz4KPHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgeD0iMzAiIHk9IjMwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiPgo8cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnoiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cjwvc3ZnPgo=">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://api.openweathermap.org">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    
    <!-- Material Icons for Enhanced UI -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            /* Color Scheme */
            --bg-color: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-color: #f5f5f7;
            --text-secondary: #a1a1aa;
            --accent-color: #ff9500;
            --accent-gradient: linear-gradient(145deg, #ff9500, #e66000);
            --accent-color-rgb: 255, 149, 0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
            
            /* Surface Colors */
            --card-bg: rgba(40, 40, 40, 0.7);
            --card-bg-hover: rgba(60, 60, 60, 0.8);
            --card-border: rgba(80, 80, 80, 0.3);
            --nav-bg: rgba(30, 30, 30, 0.9);
            --modal-bg: rgba(0, 0, 0, 0.8);
            --overlay-bg: rgba(0, 0, 0, 0.5);
            
            /* Legacy Firefox Colors */
            --firefox-red: #e66000;
            --firefox-orange: #ff9500;
            
            /* Shadows and Effects */
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            --card-hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            --card-active-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            --glow-shadow: 0 0 20px rgba(255, 149, 0, 0.3);
            
            /* Borders and Radius */
            --card-radius: 16px;
            --button-radius: 12px;
            --input-radius: 10px;
            --border-width: 1px;
            
            /* Animation and Timing */
            --transition-speed: 0.3s;
            --transition-fast: 0.15s;
            --transition-slow: 0.5s;
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-mono: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-weight-light: 300;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            
            /* Layout */
            --header-height: 60px;
            --sidebar-width: 280px;
            --content-max-width: 1200px;
            --widget-min-width: 320px;
            --widget-max-width: 400px;
            
            /* Z-Index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }
        
        /* Light mode variables */
        [data-theme="light"] {
            --bg-color: #ffffff;
            --bg-secondary: #f8fafc;
            --text-color: #1f2937;
            --text-secondary: #6b7280;
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-bg-hover: rgba(255, 255, 255, 0.9);
            --card-border: rgba(229, 231, 235, 0.8);
            --nav-bg: rgba(255, 255, 255, 0.9);
            --modal-bg: rgba(255, 255, 255, 0.9);
            --overlay-bg: rgba(0, 0, 0, 0.3);
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --card-border: rgba(255, 255, 255, 0.8);
                --text-secondary: #e5e5e5;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            :root {
                --transition-speed: 0.01ms;
                --transition-fast: 0.01ms;
                --transition-slow: 0.01ms;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }
        
        *:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        *:focus:not(:focus-visible) {
            outline: none;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            background: linear-gradient(145deg, #121212, #202020);
            padding-top: var(--space-5);
            padding-bottom: 80px;
            transition: background var(--transition-slow) ease;
            line-height: 1.6;
            font-size: var(--font-size-base);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--accent-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: var(--button-radius);
            z-index: var(--z-modal);
            transition: top var(--transition-fast);
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* Enhanced button styling */
        button, .button {
            background: var(--card-bg);
            border: var(--border-width) solid var(--card-border);
            color: var(--text-color);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--button-radius);
            cursor: pointer;
            transition: all var(--transition-speed) var(--ease-smooth);
            font-family: inherit;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            position: relative;
            overflow: hidden;
        }
        
        button:hover, .button:hover {
            background: var(--card-bg-hover);
            transform: translateY(-2px);
            box-shadow: var(--card-hover-shadow);
        }
        
        button:active, .button:active {
            transform: translateY(0);
            box-shadow: var(--card-active-shadow);
        }
        
        button:disabled, .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Enhanced input styling */
        input, textarea, select {
            background: var(--card-bg);
            border: var(--border-width) solid var(--card-border);
            color: var(--text-color);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--input-radius);
            font-family: inherit;
            font-size: var(--font-size-sm);
            transition: all var(--transition-speed) var(--ease-smooth);
            width: 100%;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--accent-color);
            background: var(--card-bg-hover);
            box-shadow: 0 0 0 3px rgba(var(--accent-color-rgb), 0.1);
        }
        
        input::placeholder, textarea::placeholder {
            color: var(--text-secondary);
            opacity: 1;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: var(--input-radius);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: var(--input-radius);
            transition: background var(--transition-speed);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--firefox-red);
        }
        
        /* Selection styling */
        ::selection {
            background: rgba(var(--accent-color-rgb), 0.3);
            color: var(--text-color);
        }
        
        ::-moz-selection {
            background: rgba(var(--accent-color-rgb), 0.3);
            color: var(--text-color);
        }
        
        /* Animation utilities */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .animate-fade-in {
            animation: fadeIn var(--transition-speed) var(--ease-smooth);
        }
        
        .animate-slide-up {
            animation: slideUp var(--transition-speed) var(--ease-smooth);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Bottom Navigation Bar */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background-color: var(--nav-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            transition: all var(--transition-speed) ease;
        }
        
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            opacity: 0.7;
            transition: all var(--transition-speed);
            text-decoration: none;
            padding: 10px;
            border-radius: 12px;
            width: 65px;
        }
        
        .bottom-nav-item:hover, .bottom-nav-item.active {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }
        
        .bottom-nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .bottom-nav-item span {
            font-size: 11px;
            text-align: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
            flex: 1;
        }
        
        /* Logo and header */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .logo {
            height: 50px;
            transition: transform 0.5s ease;
            position: relative;
            z-index: 2;
        }
        
        .logo:hover {
            transform: rotate(15deg) scale(1.1);
        }
        
        .logo-glow {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 149, 0, 0.3) 0%, rgba(255, 149, 0, 0) 70%);
            animation: pulse 3s infinite alternate;
            z-index: 1;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            100% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        /* Enhanced Search container */
        .search-container {
            margin: 30px auto;
            width: 100%;
            max-width: 580px;
            position: relative;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        
        .search-container:hover {
            transform: translateY(-3px);
        }
        
        .search-form {
            display: flex;
            width: 100%;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            font-size: 16px;
            border: none;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), inset 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed) ease;
        }
        
        .search-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-size: 22px;
            opacity: 0.7;
            z-index: 10;
        }
        
        .voice-search {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-size: 22px;
            opacity: 0.7;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .voice-search:hover {
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }
        
        .speech-recognition-active {
            animation: pulse-recording 1.5s infinite;
        }
        
        @keyframes pulse-recording {
            0% { color: var(--text-color); }
            50% { color: #f44336; }
            100% { color: var(--text-color); }
        }
        
        /* Enhanced Shortcuts */
        .shortcuts-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 auto 20px;
            max-width: 800px;
            padding: 0 15px;
        }
        
        .shortcuts-title {
            font-size: 18px;
            font-weight: 500;
            opacity: 0.8;
        }
        
        .add-shortcut-quick {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .add-shortcut-quick:hover {
            transform: scale(1.05);
        }
        
        .shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 20px;
            margin: 10px auto 40px;
            max-width: 800px;
            justify-content: center;
            padding: 0 15px;
        }
        
        .shortcut {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90px;
            height: 90px;
            border-radius: var(--card-radius);
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            text-decoration: none;
            color: var(--text-color);
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .shortcut:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
            background-color: rgba(60, 60, 60, 0.7);
            border-color: rgba(var(--accent-color), 0.3);
        }
        
        .shortcut::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .shortcut:hover::before {
            transform: scaleX(1);
        }
        
        .shortcut img {
            width: 36px;
            height: 36px;
            margin-bottom: 10px;
            border-radius: 10px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        
        .shortcut:hover img {
            transform: scale(1.1);
        }
        
        .shortcut span {
            font-size: 12px;
            max-width: 90%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .shortcut .remove-shortcut {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        
        .shortcut:hover .remove-shortcut {
            opacity: 1;
        }
        
        .shortcut .remove-shortcut:hover {
            background-color: #f44336;
            transform: scale(1.1);
        }
        
        /* Enhanced Widgets */
        .widgets-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .widgets-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .widget {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--card-radius);
            padding: 20px;
            width: 100%;
            max-width: 380px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }
        
        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .widget:hover::before {
            transform: scaleX(1);
        }
        
        .widget:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }
        
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .widget-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .widget-title i {
            color: var(--accent-color);
        }
        
        .widget-actions {
            display: flex;
            gap: 10px;
        }
        
        .widget-action {
            background: none;
            border: none;
            color: var(--text-color);
            opacity: 0.6;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .widget-action:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        /* Weather Widget */
        .weather-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .weather-temp {
            font-size: 42px;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .weather-desc {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .weather-details {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .weather-detail {
            text-align: center;
            font-size: 12px;
            opacity: 0.8;
            flex-basis: 33%;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        
        .weather-detail:hover {
            transform: scale(1.05);
            opacity: 1;
        }
        
        .weather-detail-label {
            font-size: 11px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .weather-detail-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .minmax-temp {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }
        
        .divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 15px 0;
            width: 100%;
        }
        
        .moon-phase-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }
        
        .moon-icon {
            font-size: 30px;
            margin-right: 10px;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }
        
        .moon-phase-text {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .weather-tabs {
            display: flex;
            margin-top: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .weather-tab {
            padding: 8px 12px;
            font-size: 14px;
            background: none;
            border: none;
            color: var(--text-color);
            opacity: 0.6;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative;
        }
        
        .weather-tab.active {
            opacity: 1;
        }
        
        .weather-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-gradient);
        }
        
        .weather-tab:hover {
            opacity: 0.8;
        }
        
        .weather-content {
            display: none;
            margin-top: 15px;
        }
        
        .weather-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .weather-icon {
            font-size: 42px;
            margin-right: 15px;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
        }
        
        .uv-meter {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .uv-value {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #22c55e, #eab308, #ef4444, #8b5cf6);
            width: 0%;
            transition: width 1s ease;
        }
        
        .forecast-container {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255,255,255,0.1);
            padding-bottom: 10px;
            gap: 10px;
        }
        
        .forecast-container::-webkit-scrollbar {
            height: 5px;
        }
        
        .forecast-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .forecast-container::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 10px;
        }
        
        .forecast-item {
            flex: 0 0 auto;
            text-align: center;
            padding: 10px;
            min-width: 70px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: transform 0.2s;
        }
        
        .forecast-item:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.1);
        }
        
        .forecast-day {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .forecast-icon {
            font-size: 24px;
            margin-bottom: 5px;
            filter: drop-shadow(0 0 3px rgba(255,255,255,0.2));
        }
        
        .forecast-temp {
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Clock & Date Widget */
        .clock-widget {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .clock {
            font-size: 42px;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .date {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .quote {
            font-size: 14px;
            font-style: italic;
            opacity: 0.8;
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            position: relative;
        }
        
        .quote::before, .quote::after {
            content: '"';
            font-size: 24px;
            color: var(--accent-color);
            opacity: 0.5;
        }
        
        /* News Widget */
        .news-widget {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255,255,255,0.1);
        }
        
        .news-widget::-webkit-scrollbar {
            width: 5px;
        }
        
        .news-widget::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .news-widget::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 10px;
        }
        
        .news-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s;
        }
        
        .news-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .news-item:hover {
            transform: translateX(5px);
        }
        
        .news-title {
            font-size: 15px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .news-title a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .news-title a:hover {
            color: var(--accent-color);
        }
        
        .news-source {
            font-size: 12px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .news-date {
            font-size: 11px;
            opacity: 0.6;
        }
        
        /* Todo Widget */
        .todo-form {
            display: flex;
            margin-bottom: 15px;
        }
        
        .todo-input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 10px 15px;
            border-radius: 10px 0 0 10px;
            color: var(--text-color);
        }
        
        .todo-input:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
        }
        
        .todo-submit {
            background: var(--accent-gradient);
            border: none;
            padding: 10px 15px;
            border-radius: 0 10px 10px 0;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .todo-submit:hover {
            filter: brightness(1.1);
        }
        
        .todo-list {
            max-height: 250px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255,255,255,0.1);
        }
        
        .todo-list::-webkit-scrollbar {
            width: 5px;
        }
        
        .todo-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .todo-list::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 10px;
        }
        
        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: all 0.2s;
        }
        
        .todo-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        
        .todo-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin-right: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .todo-checkbox:checked {
            background: var(--accent-color);
        }
        
        .todo-checkbox:checked::after {
            content: '✓';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .todo-text {
            flex: 1;
            transition: all 0.2s;
        }
        
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .todo-delete {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s;
        }
        
        .todo-delete:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .todo-clear {
            margin-top: 15px;
            background: none;
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .todo-clear:hover {
            background: rgba(255,255,255,0.1);
            opacity: 1;
        }
        
        /* Notes Widget */
        .notes-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .note-editor {
            width: 100%;
            min-height: 100px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px;
            color: var(--text-color);
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s;
        }
        
        .note-editor:focus {
            outline: none;
            background: rgba(255,255,255,0.1);
            border-color: var(--accent-color);
        }
        
        .note-actions {
            display: flex;
            justify-content: space-between;
        }
        
        .note-save {
            background: var(--accent-gradient);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .note-save:hover {
            filter: brightness(1.1);
        }
        
        .note-clear {
            background: none;
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.7;
        }
        
        .note-clear:hover {
            background: rgba(255,255,255,0.1);
            opacity: 1;
        }
        
        /* Calendar Widget */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-month {
            font-size: 16px;
            font-weight: 500;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s;
        }
        
        .calendar-nav-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            opacity: 0.7;
            padding: 5px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .calendar-day.other-month {
            opacity: 0.4;
        }
        
        .calendar-day.today {
            background: var(--accent-color);
            color: white;
            font-weight: 500;
        }
        
        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--accent-color);
        }
        
        .calendar-day.today.has-event::after {
            background: white;
        }
        
        /* System Status Widget */
        .system-status-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .status-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.2s;
        }
        
        .status-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }
        
        .status-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--accent-color);
        }
        
        .status-label {
            font-size: 11px;
            opacity: 0.7;
        }
        
        .status-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .battery-indicator {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .battery-level {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #eab308);
            transition: width 0.5s;
        }
        
        .battery-critical .battery-level {
            background: #f44336;
        }
        
        /* Settings Panel */
        .settings-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            z-index: 900;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .settings-btn:hover {
            transform: rotate(30deg);
            background-color: rgba(60, 60, 60, 0.7);
        }
        
        .settings-panel {
            position: fixed;
            bottom: 130px;
            right: 20px;
            width: 320px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--card-radius);
            padding: 20px;
            transform: translateY(20px);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed) ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 900;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .settings-panel.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-title i {
            color: var(--accent-color);
        }
        
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            font-size: 15px;
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .settings-section h3 i {
            color: var(--accent-color);
            font-size: 18px;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .settings-item label {
            font-size: 14px;
        }
        
        .url-input {
            width: 100%;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            margin-top: 8px;
            transition: all 0.2s;
        }
        
        .url-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(var(--accent-color), 0.3);
        }
        
        .add-btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 18px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.25);
        }
        
        .theme-options {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }
        
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .theme-btn:hover, .theme-btn.active {
            transform: scale(1.1);
            border-color: white;
        }
        
        .display-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }
        
        input:checked + .slider {
            background-color: var(--accent-color);
        }
        
        input:focus + .slider {
            box-shadow: 0 0 1px var(--accent-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .slider.round {
            border-radius: 34px;
        }
        
        .slider.round:before {
            border-radius: 50%;
        }
        
        .select-container {
            position: relative;
            margin-top: 10px;
        }
        
        .select-container::after {
            content: '▼';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .select-input {
            width: 100%;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            -webkit-appearance: none;
            appearance: none;
        }
        
        .select-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        /* Background settings */
        .background-preview {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .bg-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .bg-radio {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bg-radio:checked {
            border-color: var(--accent-color);
        }
        
        .bg-radio:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-color);
        }
        
        .bg-label {
            font-size: 14px;
            cursor: pointer;
        }
        
        .color-picker {
            width: 100%;
            height: 30px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            cursor: pointer;
        }
        
        /* Firefox message popup */
        .firefox-message {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .firefox-message.show {
            opacity: 1;
            pointer-events: auto;
        }
        
        .message-content {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--card-radius);
            padding: 25px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: messageIn 0.3s ease;
        }
        
        @keyframes messageIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .message-content h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .message-content p {
            margin-bottom: 20px;
            line-height: 1.5;
            opacity: 0.9;
        }
        
        .message-content button {
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .message-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.25);
        }
        
        /* Light mode styles */
        body.light-mode {
            background: linear-gradient(145deg, #f5f5f7, #e2e2e7);
            color: #333;
        }
        
        body.light-mode .widget,
        body.light-mode .shortcut,
        body.light-mode .settings-panel,
        body.light-mode .settings-btn,
        body.light-mode .bottom-nav {
            background-color: rgba(255, 255, 255, 0.7);
            border-color: rgba(200, 200, 200, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        body.light-mode .search-input,
        body.light-mode .url-input,
        body.light-mode .location-input,
        body.light-mode .todo-input,
        body.light-mode .note-editor,
        body.light-mode .select-input {
            background-color: rgba(255, 255, 255, 0.4);
            color: #333;
        }
        
        body.light-mode .bottom-nav-item,
        body.light-mode .settings-btn,
        body.light-mode .widget-action {
            color: #333;
        }
        
        body.light-mode .todo-item,
        body.light-mode .status-item,
        body.light-mode .forecast-item,
        body.light-mode .moon-phase-container,
        body.light-mode .minmax-temp,
        body.light-mode .quote {
            background: rgba(0,0,0,0.05);
        }
        
        body.light-mode .divider {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: var(--nav-bg);
            color: var(--text-color);
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--nav-bg) transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        /* Background patterns/options */
        .bg-pattern-dots {
            background-color: var(--bg-color);
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .bg-pattern-grid {
            background-color: var(--bg-color);
            background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                             linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .bg-pattern-waves {
            background: linear-gradient(145deg, #121212, #202020);
            position: relative;
            overflow: hidden;
        }
        
        .bg-pattern-waves::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 800 800' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='rgba(255,255,255,0.03)' d='M22.3,-27.2C28.2,-22.6,32.2,-15.2,36,-6.2C39.8,2.9,43.4,13.5,40.2,22.3C37,31.1,27,38.1,16.6,39.8C6.2,41.5,-4.6,37.8,-12.7,32.4C-20.8,27,-26.2,19.8,-28.8,12.3C-31.4,4.8,-31.1,-3.1,-28.8,-10.8C-26.4,-18.4,-22,-25.9,-15.6,-30.5C-9.3,-35.1,-0.9,-36.8,4.5,-42C9.9,-47.1,16.4,-31.8,22.3,-27.2Z' transform='translate(400 400) scale(8)'/%3E%3C/svg%3E");
            background-size: cover;
            animation: wave-animation 25s linear infinite;
            opacity: 0.5;
        }
        
        @keyframes wave-animation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .bg-pattern-circuit {
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23ffffff' fill-opacity='0.05' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 217.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E");
        }
        
        .bg-gradient-fancy {
            background: linear-gradient(45deg, #1a1a1a, #333333, #1a1a1a);
            background-size: 600% 600%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }
        
        /* For smaller screens */
        @media (max-width: 768px) {
            .widgets-row {
                flex-direction: column;
                align-items: center;
            }
            
            .widget {
                max-width: 100%;
                margin-bottom: 0;
            }
            
            .search-container {
                max-width: 90%;
            }
            
            .shortcuts {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 15px;
            }
            
            .shortcut {
                width: 80px;
                height: 80px;
            }
            
            .bottom-nav-item span {
                font-size: 10px;
            }
            
            .clock {
                font-size: 36px;
            }
            
            .weather-temp {
                font-size: 36px;
            }
            
            .weather-icon {
                font-size: 36px;
            }
            
            .settings-panel {
                width: 90%;
                max-width: 350px;
                right: 5%;
                left: 5%;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 480px) {
            .shortcuts {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            
            .shortcut {
                width: 70px;
                height: 70px;
            }
            
            .shortcut img {
                width: 30px;
                height: 30px;
            }
            
            .shortcut span {
                font-size: 11px;
            }
            
            .search-input {
                font-size: 14px;
                padding: 14px 15px 14px 45px;
            }
            
            .search-icon {
                font-size: 20px;
            }
            
            .weather-detail {
                flex-basis: 50%;
            }
            
            .clock {
                font-size: 32px;
            }
            
            .date {
                font-size: 14px;
            }
            
            .weather-temp {
                font-size: 32px;
            }
            
            .weather-icon {
                font-size: 32px;
            }
            
            .bottom-nav-item {
                padding: 8px 5px;
                width: auto;
            }
            
            .bottom-nav-item i {
                font-size: 20px;
            }
            
            .bottom-nav-item span {
                font-size: 9px;
            }
        }
        
        /* Animation utilities */
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .animate-spin {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="bg-pattern-dots">
    <!-- Firefox Logo with glow effect -->
    <div class="logo-container">
        <div class="logo-glow"></div>
        <img src="https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg" alt="Firefox Logo" class="logo">
    </div>

    <div class="container">
        <!-- Enhanced Search with icon and voice search -->
        <div class="search-container">
            <form class="search-form" id="search-form" action="https://www.google.com/search" method="GET">
                <span class="material-icons search-icon">search</span>
                <input type="text" name="q" class="search-input" placeholder="Mit Google suchen" autocomplete="off">
                <button type="button" class="material-icons voice-search" id="voice-search">mic</button>
            </form>
        </div>
        
        <!-- Shortcuts section with title and quick add button -->
        <div class="shortcuts-heading">
            <div class="shortcuts-title">Schnellzugriff</div>
            <button class="add-shortcut-quick" id="quick-add-shortcut">
                <span class="material-icons">add_circle</span> Hinzufügen
            </button>
        </div>
        
        <div class="shortcuts" id="shortcuts">
            <!-- Shortcuts will be dynamically generated -->
        </div>
        
        <!-- Widgets Container with multiple rows for better organization -->
        <div class="widgets-container">
            <!-- First row of widgets -->
            <div class="widgets-row">
                <!-- Weather Widget with enhanced UI -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">cloud</span> Wetter
                        </div>
                        <div class="widget-actions">
                            <button class="widget-action refresh-weather" title="Aktualisieren">
                                <span class="material-icons">refresh</span>
                            </button>
                            <div class="tooltip">
                                <button class="widget-action" title="Standort">
                                    <span class="material-icons">location_on</span>
                                </button>
                                <span class="tooltiptext">Aktuellen Standort verwenden</span>
                            </div>
                        </div>
                    </div>
                    
                    <input type="text" id="location-input" class="url-input" placeholder="Ort eingeben" value="Berlin">
                    
                    <div class="weather-tabs">
                        <button class="weather-tab active" data-tab="current">Aktuell</button>
                        <button class="weather-tab" data-tab="details">Details</button>
                        <button class="weather-tab" data-tab="forecast">Vorhersage</button>
                    </div>
                    
                    <div id="current-weather" class="weather-content active">
                        <div class="weather-info">
                            <div class="weather-icon">🌤️</div>
                            <div>
                                <div class="weather-temp">--°C</div>
                                <div class="weather-desc">Wird geladen...</div>
                            </div>
                        </div>
                        
                        <div class="minmax-temp">
                            <span id="min-temp">Min: --°C</span>
                            <span id="max-temp">Max: --°C</span>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="weather-details">
                            <div class="weather-detail">
                                <div class="weather-detail-label">Luftfeuchtigkeit</div>
                                <div class="weather-detail-value" id="humidity">--%</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Wind</div>
                                <div class="weather-detail-value" id="wind">-- km/h</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Luftdruck</div>
                                <div class="weather-detail-value" id="pressure">-- hPa</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Sichtweite</div>
                                <div class="weather-detail-value" id="visibility">-- km</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">UV-Index</div>
                                <div class="weather-detail-value" id="uv-index">--</div>
                                <div class="uv-meter">
                                    <div class="uv-value" id="uv-meter-value"></div>
                                </div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Gefühlt</div>
                                <div class="weather-detail-value" id="feels-like">--°C</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="details-weather" class="weather-content">
                        <div class="moon-phase-container">
                            <div class="moon-icon" id="moon-icon">🌕</div>
                            <div class="moon-phase-text" id="moon-phase">Mondphase wird geladen...</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div>
                            <div><strong>Sonnenaufgang:</strong> <span id="sunrise">--:--</span></div>
                            <div><strong>Sonnenuntergang:</strong> <span id="sunset">--:--</span></div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div>
                            <div><strong>Taupunkt:</strong> <span id="dew-point">--°C</span></div>
                            <div><strong>Wolkenbedeckung:</strong> <span id="clouds">--%</span></div>
                        </div>
                    </div>
                    
                    <div id="forecast-weather" class="weather-content">
                        <div class="forecast-container" id="forecast-container">
                            <!-- Forecast will be dynamically generated -->
                        </div>
                    </div>
                </div>
                
                <!-- Clock & Date Widget with enhanced UI -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">access_time</span> Datum & Uhrzeit
                        </div>
                    </div>
                    <div class="clock-widget">
                        <div class="clock" id="clock">00:00:00</div>
                        <div class="date" id="date">Wird geladen...</div>
                        <div class="quote" id="quote">Lade Zitat des Tages...</div>
                    </div>
                </div>
            </div>
            
            <!-- Second row of widgets -->
            <div class="widgets-row">
                <!-- News Widget (New) -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">feed</span> Nachrichten
                        </div>
                        <div class="widget-actions">
                            <button class="widget-action refresh-news" title="Aktualisieren">
                                <span class="material-icons">refresh</span>
                            </button>
                        </div>
                    </div>
                    <div class="news-widget" id="news-container">
                        <div class="news-item">
                            <div class="news-title">Nachrichten werden geladen...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Todo Widget (New) -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">check_circle</span> Aufgaben
                        </div>
                    </div>
                    <form id="todo-form" class="todo-form">
                        <input type="text" id="todo-input" class="todo-input" placeholder="Neue Aufgabe hinzufügen...">
                        <button type="submit" class="todo-submit">
                            <span class="material-icons">add</span>
                        </button>
                    </form>
                    <div class="todo-list" id="todo-list">
                        <!-- Todo items will be dynamically generated -->
                    </div>
                    <button id="clear-completed" class="todo-clear">Erledigte Aufgaben löschen</button>
                </div>
            </div>
            
            <!-- Third row of widgets -->
            <div class="widgets-row">
                <!-- Notes Widget (New) -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">note</span> Notizen
                        </div>
                    </div>
                    <div class="notes-container">
                        <textarea id="note-editor" class="note-editor" placeholder="Schreibe deine Notizen hier..."></textarea>
                        <div class="note-actions">
                            <button id="save-note" class="note-save">Speichern</button>
                            <button id="clear-note" class="note-clear">Löschen</button>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Widget (New) -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">calendar_today</span> Kalender
                        </div>
                    </div>
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" id="prev-month">
                                <span class="material-icons">chevron_left</span>
                            </button>
                        </div>
                        <div class="calendar-month" id="calendar-month">Mai 2025</div>
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" id="next-month">
                                <span class="material-icons">chevron_right</span>
                            </button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar-weekdays">
                        <!-- Weekday headers will be dynamically generated -->
                    </div>
                    <div class="calendar-grid" id="calendar-days">
                        <!-- Calendar days will be dynamically generated -->
                    </div>
                </div>
            </div>
            
            <!-- Fourth row of widgets -->
            <div class="widgets-row">
                <!-- System Status Widget (New) -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">analytics</span> System Status
                        </div>
                        <div class="widget-actions">
                            <button class="widget-action refresh-status" title="Aktualisieren">
                                <span class="material-icons">refresh</span>
                            </button>
                        </div>
                    </div>
                    <div class="system-status-container">
                        <div class="status-item">
                            <span class="material-icons status-icon">battery_charging_full</span>
                            <span class="status-label">Akku</span>
                            <span class="status-value" id="battery-status">--</span>
                            <div class="battery-indicator">
                                <div class="battery-level" id="battery-level"></div>
                            </div>
                        </div>
                        <div class="status-item">
                            <span class="material-icons status-icon">memory</span>
                            <span class="status-label">Speicher</span>
                            <span class="status-value" id="memory-status">--</span>
                        </div>
                        <div class="status-item">
                            <span class="material-icons status-icon">wifi</span>
                            <span class="status-label">Netzwerk</span>
                            <span class="status-value" id="network-status">--</span>
                        </div>
                        <div class="status-item">
                            <span class="material-icons status-icon">speed</span>
                            <span class="status-label">Ladezeit</span>
                            <span class="status-value" id="page-load">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Bottom Navigation Bar -->
    <div class="bottom-nav">
        <a href="#" class="bottom-nav-item active" id="home-button">
            <span class="material-icons">home</span>
            <span>Startseite</span>
        </a>
        <a href="#" class="bottom-nav-item" id="bookmarks-button">
            <span class="material-icons">bookmark</span>
            <span>Lesezeichen</span>
        </a>
        <a href="#" class="bottom-nav-item" id="downloads-button">
            <span class="material-icons">download</span>
            <span>Downloads</span>
        </a>
        <a href="#" class="bottom-nav-item" id="history-button">
            <span class="material-icons">history</span>
            <span>Verlauf</span>
        </a>
        <a href="#" class="bottom-nav-item" id="addons-button">
            <span class="material-icons">extension</span>
            <span>Add-ons</span>
        </a>
    </div>
    
    <!-- Settings Button with enhanced animation -->
    <div class="settings-btn" id="settings-btn">
        <span class="material-icons">settings</span>
    </div>
    
    <!-- Enhanced Settings Panel with more options -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-title">
            <span class="material-icons">settings</span> Einstellungen
        </div>
        
        <div class="settings-section">
            <h3><span class="material-icons">add_link</span> Verknüpfung hinzufügen</h3>
            <div>
                <label for="shortcut-name">Name</label>
                <input type="text" id="shortcut-name" class="url-input" placeholder="z.B. YouTube">
            </div>
            <div>
                <label for="shortcut-url">URL</label>
                <input type="text" id="shortcut-url" class="url-input" placeholder="z.B. https://youtube.com">
            </div>
            <div>
                <label for="shortcut-icon">Icon URL (Optional)</label>
                <input type="text" id="shortcut-icon" class="url-input" placeholder="Standard-Favicon wird verwendet">
            </div>
            <button class="add-btn" id="add-shortcut-btn">
                <span class="material-icons">add</span> Hinzufügen
            </button>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">palette</span> Theme</h3>
            <div class="theme-options">
                <button class="theme-btn active" data-theme="firefox" style="background: linear-gradient(45deg, #ff9500, #e66000)"></button>
                <button class="theme-btn" data-theme="blue" style="background: linear-gradient(45deg, #0071e3, #005bb5)"></button>
                <button class="theme-btn" data-theme="green" style="background: linear-gradient(45deg, #28cd41, #1eb234)"></button>
                <button class="theme-btn" data-theme="purple" style="background: linear-gradient(45deg, #8A2BE2, #6a16c8)"></button>
                <button class="theme-btn" data-theme="pink" style="background: linear-gradient(45deg, #FF1493, #C71585)"></button>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">dark_mode</span> Anzeigemodus</h3>
            <div class="display-mode-toggle">
                <span>Dunkel</span>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider round"></span>
                </label>
                <span>Hell</span>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">search</span> Suchmaschine</h3>
            <div class="select-container">
                <select id="search-engine-select" class="select-input">
                    <option value="https://www.google.com/search">Google</option>
                    <option value="https://www.bing.com/search">Bing</option>
                    <option value="https://search.yahoo.com/search">Yahoo</option>
                    <option value="https://duckduckgo.com/">DuckDuckGo</option>
                    <option value="https://www.ecosia.org/search">Ecosia</option>
                </select>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">wallpaper</span> Hintergrund</h3>
            <div class="bg-option">
                <input type="radio" id="bg-dots" name="bg-pattern" value="dots" class="bg-radio" checked>
                <label for="bg-dots" class="bg-label">Punkte</label>
            </div>
            <div class="bg-option">
                <input type="radio" id="bg-grid" name="bg-pattern" value="grid" class="bg-radio">
                <label for="bg-grid" class="bg-label">Gitter</label>
            </div>
            <div class="bg-option">
                <input type="radio" id="bg-waves" name="bg-pattern" value="waves" class="bg-radio">
                <label for="bg-waves" class="bg-label">Wellen</label>
            </div>
            <div class="bg-option">
                <input type="radio" id="bg-circuit" name="bg-pattern" value="circuit" class="bg-radio">
                <label for="bg-circuit" class="bg-label">Schaltkreis</label>
            </div>
            <div class="bg-option">
                <input type="radio" id="bg-gradient" name="bg-pattern" value="gradient" class="bg-radio">
                <label for="bg-gradient" class="bg-label">Farbverlauf</label>
            </div>
            <div class="bg-option">
                <input type="radio" id="bg-solid" name="bg-pattern" value="solid" class="bg-radio">
                <label for="bg-solid" class="bg-label">Einfarbig</label>
            </div>
            <div class="background-preview" id="bg-preview"></div>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">import_export</span> Daten verwalten</h3>
            <div class="settings-item">
                <label>Daten exportieren</label>
                <button type="button" class="add-btn" onclick="exportData()">
                    <span class="material-icons">download</span>
                    Backup erstellen
                </button>
            </div>
            <div class="settings-item">
                <label>Daten importieren</label>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(this.files[0])">
                <button type="button" class="add-btn" onclick="document.getElementById('import-file').click()">
                    <span class="material-icons">upload</span>
                    Backup wiederherstellen
                </button>
            </div>
            <div class="settings-item">
                <label>Alle Daten löschen</label>
                <button type="button" class="add-btn" style="background: var(--error-color);" onclick="if(confirm('Alle lokalen Daten löschen?')) { localStorage.clear(); location.reload(); }">
                    <span class="material-icons">delete_forever</span>
                    Zurücksetzen
                </button>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="settings-section">
            <h3><span class="material-icons">keyboard</span> Tastenkürzel</h3>
            <div class="shortcuts-help">
                <div class="shortcut-item">
                    <kbd>Ctrl+K</kbd>
                    <span>Suche fokussieren</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Ctrl+,</kbd>
                    <span>Einstellungen öffnen</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Ctrl+S</kbd>
                    <span>Daten exportieren</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Alt+1-4</kbd>
                    <span>Widgets umschalten</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Alt+P</kbd>
                    <span>Pomodoro Timer</span>
                </div>
                <div class="shortcut-item">
                    <kbd>!export</kbd>
                    <span>Daten exportieren (Suche)</span>
                </div>
                <div class="shortcut-item">
                    <kbd>!calc</kbd>
                    <span>Taschenrechner öffnen</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firefox message popup with enhanced animation -->
    <div class="firefox-message" id="firefox-message">
        <div class="message-content">
            <h3><span class="material-icons">info</span> Firefox-Funktion</h3>
            <p id="message-text">Diese Funktion würde in einer echten Firefox-Erweiterung funktionieren.</p>
            <button id="close-message">Verstanden</button>
        </div>
    </div>

    <!-- Add this right after the closing </div> of your last widget in the widgets-row section -->
<!-- Chat Widget (New) -->
<div class="widget">
    <div class="widget-header">
        <div class="widget-title">
            <span class="material-icons">chat</span> Freunde-Chat
        </div>
        <div class="widget-actions">
            <button class="widget-action" id="refresh-chat" title="Aktualisieren">
                <span class="material-icons">refresh</span>
            </button>
        </div>
    </div>
    
    <div id="chat-login-area" style="display: block;">
        <input type="text" id="username-input" class="url-input" placeholder="Dein Benutzername">
        <button id="login-button" class="add-btn" style="width: 100%;">
            <span class="material-icons">login</span> Einloggen
        </button>
    </div>
    
    <div id="chat-area" style="display: none;">
        <div class="chat-header">
            <span id="logged-in-as">Eingeloggt als: </span>
            <button id="logout-button" class="note-clear" style="margin-left: auto; padding: 4px 8px;">
                <span class="material-icons" style="font-size: 16px;">logout</span>
            </button>
        </div>
        
        <div id="chat-messages" class="chat-messages">
            <!-- Messages will appear here -->
        </div>
        
        <div class="chat-input-area">
            <input type="text" id="message-input" class="url-input" placeholder="Nachricht schreiben...">
            <button id="send-button" class="add-btn" style="margin-top: 8px; width: 100%;">
                <span class="material-icons">send</span> Senden
            </button>
        </div>
    </div>
</div>

    <!-- Additional Advanced Widgets -->
    <div class="widgets-container" id="advanced-widgets">
        <div class="widgets-row">
            <!-- Music Player Widget -->
            <div class="widget" id="music-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">music_note</span>
                        Musikplayer
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('music-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="music-player">
                    <div class="current-track">
                        <div class="track-art">
                            <span class="material-icons">album</span>
                        </div>
                        <div class="track-info">
                            <div class="track-title">Keine Musik</div>
                            <div class="track-artist">Wähle eine Datei aus</div>
                        </div>
                    </div>
                    <div class="music-controls">
                        <button class="control-btn" id="prev-btn">
                            <span class="material-icons">skip_previous</span>
                        </button>
                        <button class="control-btn primary" id="play-btn">
                            <span class="material-icons">play_arrow</span>
                        </button>
                        <button class="control-btn" id="next-btn">
                            <span class="material-icons">skip_next</span>
                        </button>
                    </div>
                    <div class="progress-container">
                        <span class="time-display" id="current-time">0:00</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                            <input type="range" class="progress-slider" id="progress-slider" min="0" max="100" value="0">
                        </div>
                        <span class="time-display" id="total-time">0:00</span>
                    </div>
                    <div class="volume-container">
                        <span class="material-icons">volume_up</span>
                        <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50">
                    </div>
                    <input type="file" id="music-file-input" accept="audio/*" style="display: none;">
                    <button class="add-btn" onclick="document.getElementById('music-file-input').click()">
                        <span class="material-icons">library_music</span>
                        Datei auswählen
                    </button>
                </div>
            </div>

            <!-- Calculator Widget -->
            <div class="widget" id="calculator-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">calculate</span>
                        Taschenrechner
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action" title="Löschen" onclick="clearCalculator()">
                            <span class="material-icons">clear</span>
                        </button>
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('calculator-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="calculator">
                    <div class="calc-display">
                        <div class="calc-expression" id="calc-expression"></div>
                        <div class="calc-result" id="calc-result">0</div>
                    </div>
                    <div class="calc-buttons">
                        <button class="calc-btn clear" onclick="clearCalculator()">C</button>
                        <button class="calc-btn clear" onclick="clearEntry()">CE</button>
                        <button class="calc-btn operator" onclick="deleteLast()">⌫</button>
                        <button class="calc-btn operator" onclick="inputOperator('/')">/</button>
                        
                        <button class="calc-btn number" onclick="inputNumber('7')">7</button>
                        <button class="calc-btn number" onclick="inputNumber('8')">8</button>
                        <button class="calc-btn number" onclick="inputNumber('9')">9</button>
                        <button class="calc-btn operator" onclick="inputOperator('*')">×</button>
                        
                        <button class="calc-btn number" onclick="inputNumber('4')">4</button>
                        <button class="calc-btn number" onclick="inputNumber('5')">5</button>
                        <button class="calc-btn number" onclick="inputNumber('6')">6</button>
                        <button class="calc-btn operator" onclick="inputOperator('-')">-</button>
                        
                        <button class="calc-btn number" onclick="inputNumber('1')">1</button>
                        <button class="calc-btn number" onclick="inputNumber('2')">2</button>
                        <button class="calc-btn number" onclick="inputNumber('3')">3</button>
                        <button class="calc-btn operator" onclick="inputOperator('+')">+</button>
                        
                        <button class="calc-btn number wide" onclick="inputNumber('0')">0</button>
                        <button class="calc-btn number" onclick="inputDecimal()">.</button>
                        <button class="calc-btn equals" onclick="calculate()">=</button>
                    </div>
                </div>
            </div>

            <!-- Crypto Tracker Widget -->
            <div class="widget" id="crypto-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">trending_up</span>
                        Kryptowährungen
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action refresh-crypto" title="Aktualisieren">
                            <span class="material-icons">refresh</span>
                        </button>
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('crypto-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="crypto-tracker">
                    <div class="crypto-list" id="crypto-list">
                        <div class="crypto-item">
                            <div class="crypto-info">
                                <div class="crypto-symbol">BTC</div>
                                <div class="crypto-name">Bitcoin</div>
                            </div>
                            <div class="crypto-price">
                                <div class="price" id="btc-price">$0</div>
                                <div class="change" id="btc-change">0%</div>
                            </div>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-info">
                                <div class="crypto-symbol">ETH</div>
                                <div class="crypto-name">Ethereum</div>
                            </div>
                            <div class="crypto-price">
                                <div class="price" id="eth-price">$0</div>
                                <div class="change" id="eth-change">0%</div>
                            </div>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-info">
                                <div class="crypto-symbol">ADA</div>
                                <div class="crypto-name">Cardano</div>
                            </div>
                            <div class="crypto-price">
                                <div class="price" id="ada-price">$0</div>
                                <div class="change" id="ada-change">0%</div>
                            </div>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-info">
                                <div class="crypto-symbol">DOT</div>
                                <div class="crypto-name">Polkadot</div>
                            </div>
                            <div class="crypto-price">
                                <div class="price" id="dot-price">$0</div>
                                <div class="change" id="dot-change">0%</div>
                            </div>
                        </div>
                    </div>
                    <div class="crypto-summary">
                        <div class="market-cap">
                            <span class="label">Marktkapitalisierung:</span>
                            <span class="value" id="total-market-cap">$0</span>
                        </div>
                        <div class="last-updated">
                            Zuletzt aktualisiert: <span id="crypto-update-time">Nie</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Row of Advanced Widgets -->
        <div class="widgets-row">
            <!-- Pomodoro Timer Widget -->
            <div class="widget" id="pomodoro-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">timer</span>
                        Pomodoro Timer
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('pomodoro-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="pomodoro-timer">
                    <div class="timer-display">
                        <div class="timer-circle">
                            <svg class="timer-svg" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--card-border)" stroke-width="2"/>
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--accent-color)" stroke-width="3" 
                                        stroke-dasharray="283" stroke-dashoffset="283" id="timer-progress"/>
                            </svg>
                            <div class="timer-time" id="timer-time">25:00</div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button class="control-btn" id="timer-start">
                            <span class="material-icons">play_arrow</span>
                        </button>
                        <button class="control-btn" id="timer-pause" style="display: none;">
                            <span class="material-icons">pause</span>
                        </button>
                        <button class="control-btn" id="timer-reset">
                            <span class="material-icons">refresh</span>
                        </button>
                    </div>
                    <div class="timer-modes">
                        <button class="mode-btn active" data-mode="work">Arbeit (25min)</button>
                        <button class="mode-btn" data-mode="break">Pause (5min)</button>
                        <button class="mode-btn" data-mode="longbreak">Lange Pause (15min)</button>
                    </div>
                    <div class="pomodoro-stats">
                        <div class="stat">
                            <span class="stat-label">Heute:</span>
                            <span class="stat-value" id="today-pomodoros">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Gesamt:</span>
                            <span class="stat-value" id="total-pomodoros">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QR Code Generator Widget -->
            <div class="widget" id="qr-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">qr_code</span>
                        QR Code Generator
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action" title="Herunterladen" onclick="downloadQR()">
                            <span class="material-icons">download</span>
                        </button>
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('qr-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="qr-generator">
                    <div class="qr-input-area">
                        <textarea id="qr-text-input" placeholder="Text oder URL eingeben..." rows="3"></textarea>
                        <button class="add-btn" onclick="generateQR()">
                            <span class="material-icons">qr_code_2</span>
                            QR Code erstellen
                        </button>
                    </div>
                    <div class="qr-display" id="qr-display">
                        <div class="qr-placeholder">
                            <span class="material-icons">qr_code</span>
                            <p>QR Code wird hier angezeigt</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Color Palette Widget -->
            <div class="widget" id="color-widget">
                <div class="widget-header">
                    <div class="widget-title">
                        <span class="material-icons">palette</span>
                        Farbpalette
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action" title="Zufällige Palette" onclick="generateRandomPalette()">
                            <span class="material-icons">shuffle</span>
                        </button>
                        <button class="widget-action" title="Minimieren" onclick="toggleWidget('color-widget')">
                            <span class="material-icons">remove</span>
                        </button>
                    </div>
                </div>
                <div class="color-palette">
                    <div class="color-input-area">
                        <input type="color" id="color-picker" value="#ff9500">
                        <button class="add-btn" onclick="addColorToPalette()">
                            <span class="material-icons">add</span>
                            Farbe hinzufügen
                        </button>
                    </div>
                    <div class="palette-display" id="palette-display">
                        <div class="color-swatch" data-color="#ff9500" style="background: #ff9500;">
                            <span class="color-code">#ff9500</span>
                        </div>
                        <div class="color-swatch" data-color="#e66000" style="background: #e66000;">
                            <span class="color-code">#e66000</span>
                        </div>
                        <div class="color-swatch" data-color="#0071e3" style="background: #0071e3;">
                            <span class="color-code">#0071e3</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- PWA Install Button -->
    <div id="install-prompt" class="install-prompt" style="display: none;">
        <div class="install-content">
            <div class="install-icon">
                <span class="material-icons">install_mobile</span>
            </div>
            <div class="install-text">
                <h3>App installieren</h3>
                <p>Installiere diese Startseite als App für schnelleren Zugriff</p>
            </div>
            <div class="install-actions">
                <button id="install-btn" class="add-btn">
                    <span class="material-icons">download</span>
                    Installieren
                </button>
                <button id="install-dismiss" class="widget-action">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Permission Prompt -->
    <div id="notification-prompt" class="notification-prompt" style="display: none;">
        <div class="notification-content">
            <div class="notification-icon">
                <span class="material-icons">notifications</span>
            </div>
            <div class="notification-text">
                <h3>Benachrichtigungen aktivieren</h3>
                <p>Erhalte Updates zu Wetter, News und Erinnerungen</p>
            </div>
            <div class="notification-actions">
                <button id="notification-allow" class="add-btn">
                    <span class="material-icons">check</span>
                    Erlauben
                </button>
                <button id="notification-deny" class="widget-action">
                    <span class="material-icons">close</span>
                    Nicht jetzt
                </button>
            </div>
        </div>
    </div>
<style>
    .chat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
        opacity: 0.8;
    }
    
    .chat-messages {
        max-height: 250px;
        overflow-y: auto;
        margin-bottom: 10px;
        padding: 10px;
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        scrollbar-width: thin;
        scrollbar-color: var(--accent-color) rgba(255,255,255,0.1);
    }
    
    .chat-messages::-webkit-scrollbar {
        width: 5px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.1);
        border-radius: 10px;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
        background-color: var(--accent-color);
        border-radius: 10px;
    }
    
    .chat-message {
        margin-bottom: 10px;
        padding: 8px 12px;
        border-radius: 10px;
        animation: fadeIn 0.3s ease;
        word-wrap: break-word;
    }
    
    .chat-message-own {
        background: rgba(var(--accent-color-rgb), 0.2);
        margin-left: 20px;
        border-top-right-radius: 2px;
    }
    
    .chat-message-other {
        background: rgba(255,255,255,0.1);
        margin-right: 20px;
        border-top-left-radius: 2px;
    }
    
    .chat-username {
        font-weight: 500;
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 3px;
    }
    
    .chat-text {
        font-size: 14px;
    }
    
    .chat-time {
        text-align: right;
        font-size: 10px;
        opacity: 0.6;
        margin-top: 3px;
    }
    
    .chat-input-area {
        margin-top: 10px;
    }
    
        /* Advanced Widgets Styles */
        #advanced-widgets {
            margin-top: var(--space-8);
        }
        
        /* Music Player Widget */
        .music-player {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .current-track {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: rgba(255,255,255,0.05);
            border-radius: var(--input-radius);
        }
        
        .track-art {
            width: 48px;
            height: 48px;
            background: var(--card-bg);
            border-radius: var(--input-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .track-art .material-icons {
            font-size: 24px;
            color: var(--accent-color);
        }
        
        .track-info {
            flex: 1;
            min-width: 0;
        }
        
        .track-title {
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-1);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .track-artist {
            font-size: var(--font-size-sm);
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-4);
        }
        
        .control-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--card-bg);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .control-btn:hover {
            background: var(--card-bg-hover);
            transform: scale(1.1);
        }
        
        .control-btn.primary {
            background: var(--accent-color);
            color: white;
            width: 56px;
            height: 56px;
        }
        
        .control-btn.primary:hover {
            background: var(--firefox-red);
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .time-display {
            font-size: var(--font-size-sm);
            font-family: var(--font-mono);
            min-width: 40px;
            text-align: center;
        }
        
        .progress-bar {
            flex: 1;
            height: 6px;
            background: var(--card-bg);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .progress-slider {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .volume-slider {
            width: 80px;
            height: 4px;
            background: var(--card-bg);
            border-radius: 2px;
            appearance: none;
            cursor: pointer;
        }
        
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Calculator Widget */
        .calculator {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .calc-display {
            background: rgba(0,0,0,0.2);
            border-radius: var(--input-radius);
            padding: var(--space-4);
            text-align: right;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .calc-expression {
            font-size: var(--font-size-sm);
            opacity: 0.7;
            margin-bottom: var(--space-1);
            font-family: var(--font-mono);
            min-height: 20px;
        }
        
        .calc-result {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            font-family: var(--font-mono);
            word-break: break-all;
        }
        
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
        }
        
        .calc-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: var(--button-radius);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-btn:hover {
            background: var(--card-bg-hover);
            transform: scale(1.05);
        }
        
        .calc-btn.operator {
            background: var(--accent-color);
            color: white;
        }
        
        .calc-btn.operator:hover {
            background: var(--firefox-red);
        }
        
        .calc-btn.equals {
            background: var(--success-color);
            color: white;
        }
        
        .calc-btn.equals:hover {
            background: #059669;
        }
        
        .calc-btn.clear {
            background: var(--error-color);
            color: white;
        }
        
        .calc-btn.clear:hover {
            background: #dc2626;
        }
        
        .calc-btn.wide {
            grid-column: span 2;
        }
        
        /* Crypto Tracker Widget */
        .crypto-tracker {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .crypto-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .crypto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3);
            background: rgba(255,255,255,0.05);
            border-radius: var(--input-radius);
            transition: all var(--transition-speed);
        }
        
        .crypto-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        
        .crypto-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .crypto-symbol {
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-lg);
        }
        
        .crypto-name {
            font-size: var(--font-size-sm);
            opacity: 0.7;
        }
        
        .crypto-price {
            text-align: right;
        }
        
        .price {
            font-weight: var(--font-weight-bold);
            font-family: var(--font-mono);
        }
        
        .change {
            font-size: var(--font-size-sm);
            font-family: var(--font-mono);
        }
        
        .change.positive {
            color: var(--success-color);
        }
        
        .change.negative {
            color: var(--error-color);
        }
        
        .crypto-summary {
            padding: var(--space-3);
            background: rgba(255,255,255,0.05);
            border-radius: var(--input-radius);
        }
        
        .market-cap {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
        }
        
        .last-updated {
            font-size: var(--font-size-xs);
            opacity: 0.6;
            text-align: center;
        }
        
        /* Pomodoro Timer Widget */
        .pomodoro-timer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-4);
        }
        
        .timer-display {
            position: relative;
        }
        
        .timer-circle {
            position: relative;
            width: 120px;
            height: 120px;
        }
        
        .timer-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .timer-time {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            font-family: var(--font-mono);
        }
        
        .timer-modes {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }
        
        .mode-btn {
            padding: var(--space-2) var(--space-3);
            border: var(--border-width) solid var(--card-border);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: var(--button-radius);
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: var(--font-size-sm);
        }
        
        .mode-btn:hover {
            background: var(--card-bg-hover);
        }
        
        .mode-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .pomodoro-stats {
            display: flex;
            gap: var(--space-6);
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-label {
            display: block;
            font-size: var(--font-size-sm);
            opacity: 0.7;
            margin-bottom: var(--space-1);
        }
        
        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--accent-color);
        }
        
        /* QR Code Widget */
        .qr-generator {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .qr-input-area {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .qr-display {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: var(--input-radius);
            border: 2px dashed var(--card-border);
        }
        
        .qr-placeholder {
            text-align: center;
            opacity: 0.5;
        }
        
        .qr-placeholder .material-icons {
            font-size: 48px;
            margin-bottom: var(--space-2);
        }
        
        .qr-code-container {
            padding: var(--space-4);
            background: white;
            border-radius: var(--input-radius);
        }
        
        /* Color Palette Widget */
        .color-palette {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .color-input-area {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        #color-picker {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: var(--input-radius);
            cursor: pointer;
        }
        
        .palette-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: var(--space-2);
        }
        
        .color-swatch {
            aspect-ratio: 1;
            border-radius: var(--input-radius);
            position: relative;
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .color-swatch:hover {
            transform: scale(1.05);
            box-shadow: var(--card-hover-shadow);
        }
        
        .color-code {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--input-radius);
            font-size: var(--font-size-xs);
            font-family: var(--font-mono);
            opacity: 0;
            transition: opacity var(--transition-speed);
        }
        
        .color-swatch:hover .color-code {
            opacity: 1;
        }
        
        /* PWA Install Prompt */
        .install-prompt, .notification-prompt {
            position: fixed;
            bottom: 90px;
            right: 20px;
            max-width: 350px;
            background: var(--card-bg);
            border: var(--border-width) solid var(--card-border);
            border-radius: var(--card-radius);
            padding: var(--space-4);
            box-shadow: var(--card-hover-shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: var(--z-toast);
            animation: slideUp var(--transition-speed) var(--ease-smooth);
        }
        
        .install-content, .notification-content {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }
        
        .install-icon, .notification-icon {
            background: var(--accent-color);
            color: white;
            padding: var(--space-2);
            border-radius: var(--button-radius);
            flex-shrink: 0;
        }
        
        .install-text, .notification-text {
            flex: 1;
        }
        
        .install-text h3, .notification-text h3 {
            margin-bottom: var(--space-1);
            font-size: var(--font-size-lg);
        }
        
        .install-text p, .notification-text p {
            font-size: var(--font-size-sm);
            opacity: 0.8;
            margin-bottom: var(--space-3);
        }
        
        .install-actions, .notification-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        /* Widget minimization */
        .widget.minimized .widget-content,
        .widget.minimized .music-player,
        .widget.minimized .calculator,
        .widget.minimized .crypto-tracker,
        .widget.minimized .pomodoro-timer,
        .widget.minimized .qr-generator,
        .widget.minimized .color-palette {
            display: none;
        }
        
        .widget.minimized {
            min-height: auto;
        }
        
        /* Responsive enhancements */
        @media (max-width: 768px) {
            .widgets-row {
                flex-direction: column;
            }
            
            .calc-buttons {
                gap: var(--space-1);
            }
            
            .calc-btn {
                font-size: var(--font-size-base);
            }
            
            .install-prompt, .notification-prompt {
                right: 10px;
                left: 10px;
                max-width: none;
                bottom: 80px;
            }
            
            .timer-circle {
                width: 100px;
                height: 100px;
            }
            
            .timer-time {
                font-size: var(--font-size-lg);
            }
        }
        
        /* Enhanced settings panel styles */
        .shortcuts-help {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) var(--space-3);
            background: rgba(255,255,255,0.05);
            border-radius: var(--input-radius);
        }
        
        .shortcut-item kbd {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 4px;
            padding: 2px 6px;
            font-family: var(--font-mono);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }
        
        .shortcut-item span {
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }
        
        /* Dark/Light mode transitions */
        @media (prefers-color-scheme: light) {
            .qr-code-container {
                background: var(--bg-color);
            }
        }
</style>

<!-- Add Firebase scripts right before your closing </body> tag -->
<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<!-- Firebase Database -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Add the chat functionality to your existing script -->
<script>
    // Initialize Firebase - Replace with your Firebase configuration
    const firebaseConfig = {

  apiKey: "AIzaSyCgbZEjTgLsQ4NadP3afaS8nBW7_RByo5E",

  authDomain: "browserhost.firebaseapp.com",

  databaseURL: "https://browserhost-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "browserhost",

  storageBucket: "browserhost.firebasestorage.app",

  messagingSenderId: "1019208612410",

  appId: "1:1019208612410:web:1b57c879e16a4a87485303",

  measurementId: "G-5TM78L2J2Y"

};

    
    // Initialize Firebase if not already initialized
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    
    // Get Firebase services
    const auth = firebase.auth();
    const database = firebase.database();
    
    // Chat functionality
    function initChat() {
        const loginArea = document.getElementById('chat-login-area');
        const chatArea = document.getElementById('chat-area');
        const usernameInput = document.getElementById('username-input');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const loggedInAs = document.getElementById('logged-in-as');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const refreshChat = document.getElementById('refresh-chat');
        
        let currentUser = null;
        
        // Login with username
        loginButton.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (username) {
                // Save username to localStorage
                localStorage.setItem('chatUsername', username);
                currentUser = username;
                
                // Update UI
                loginArea.style.display = 'none';
                chatArea.style.display = 'block';
                loggedInAs.textContent = `Eingeloggt als: ${username}`;
                
                // Load messages
                loadMessages();
            }
        });
        
        // Logout
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('chatUsername');
            currentUser = null;
            
            // Update UI
            loginArea.style.display = 'block';
            chatArea.style.display = 'none';
            chatMessages.innerHTML = '';
        });
        
        // Send message
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Refresh chat
        refreshChat.addEventListener('click', () => {
            refreshChat.classList.add('animate-spin');
            loadMessages().then(() => {
                setTimeout(() => {
                    refreshChat.classList.remove('animate-spin');
                }, 500);
            });
        });
        
        // Send message function
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message && currentUser) {
                // Create message object
                const newMessage = {
                    username: currentUser,
                    text: message,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Add to Firebase
                database.ref('messages').push(newMessage)
                    .then(() => {
                        // Clear input field
                        messageInput.value = '';
                        
                        // Scroll to bottom
                        setTimeout(() => {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 100);
                    })
                    .catch(error => {
                        console.error('Error sending message:', error);
                    });
            }
        }
        
        // Load messages
        async function loadMessages() {
            // Reference to messages in database
            const messagesRef = database.ref('messages');
            
            // Get last 50 messages
            messagesRef.orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                // Clear previous messages
                chatMessages.innerHTML = '';
                
                // Get message data
                const messages = snapshot.val();
                
                if (messages) {
                    // Convert to array and sort by timestamp
                    const messagesList = Object.entries(messages).map(([id, data]) => ({
                        id,
                        ...data
                    })).sort((a, b) => a.timestamp - b.timestamp);
                    
                    // Add messages to UI
                    messagesList.forEach(message => {
                        const messageElement = document.createElement('div');
                        
                        // Check if message is from current user
                        const isOwnMessage = message.username === currentUser;
                        messageElement.className = `chat-message ${isOwnMessage ? 'chat-message-own' : 'chat-message-other'}`;
                        
                        // Format timestamp
                        const date = new Date(message.timestamp);
                        const timeString = date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                        
                        // Add message content
                        messageElement.innerHTML = `
                            <div class="chat-username">${message.username}</div>
                            <div class="chat-text">${message.text}</div>
                            <div class="chat-time">${timeString}</div>
                        `;
                        
                        chatMessages.appendChild(messageElement);
                    });
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            });
            
            return Promise.resolve();
        }
        
        // Check if user is already logged in
        const savedUsername = localStorage.getItem('chatUsername');
        if (savedUsername) {
            currentUser = savedUsername;
            loginArea.style.display = 'none';
            chatArea.style.display = 'block';
            loggedInAs.textContent = `Eingeloggt als: ${savedUsername}`;
            loadMessages();
        }
    }
    
    // Initialize chat when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Add initChat to your initializations
        initChat();
    });
</script>
    
    <script>
        // Default shortcuts with real favicon URLs
        const defaultShortcuts = [
            { name: 'YouTube', url: 'https://youtube.com', icon: 'https://www.youtube.com/favicon.ico' },
            { name: 'Gmail', url: 'https://mail.google.com', icon: 'https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico' },
            { name: 'Twitter', url: 'https://twitter.com', icon: 'https://twitter.com/favicon.ico' },
            { name: 'GitHub', url: 'https://github.com', icon: 'https://github.com/favicon.ico' },
            { name: 'Netflix', url: 'https://netflix.com', icon: 'https://assets.nflxext.com/us/ffe/siteui/common/icons/nficon2016.ico' },
            { name: 'Amazon', url: 'https://amazon.com', icon: 'https://www.amazon.com/favicon.ico' },
            { name: 'Reddit', url: 'https://reddit.com', icon: 'https://www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png' },
            { name: 'Wikipedia', url: 'https://wikipedia.org', icon: 'https://en.wikipedia.org/static/favicon/wikipedia.ico' }
        ];
        
        // German News Sources for the News Widget
        const germanNewsSources = [
            { name: 'Tagesschau', url: 'https://www.tagesschau.de' },
            { name: 'Spiegel', url: 'https://www.spiegel.de' },
            { name: 'Zeit', url: 'https://www.zeit.de' },
            { name: 'Süddeutsche', url: 'https://www.sueddeutsche.de' },
            { name: 'Focus', url: 'https://www.focus.de' },
            { name: 'Bild', url: 'https://www.bild.de' }
        ];
        
        // Load shortcuts from localStorage or use defaults
        function loadShortcuts() {
            const shortcuts = JSON.parse(localStorage.getItem('shortcuts')) || defaultShortcuts;
            const shortcutsContainer = document.getElementById('shortcuts');
            shortcutsContainer.innerHTML = '';
            
            shortcuts.forEach((shortcut, index) => {
                const shortcutElement = document.createElement('a');
                shortcutElement.className = 'shortcut';
                shortcutElement.href = shortcut.url;
                
                // Use Google's favicon service as fallback if no icon provided
                const iconUrl = shortcut.icon || `https://www.google.com/s2/favicons?domain=${new URL(shortcut.url).hostname}&sz=64`;
                
                shortcutElement.innerHTML = `
                    <div class="remove-shortcut" data-index="${index}">×</div>
                    <img src="${iconUrl}" alt="${shortcut.name}" onerror="this.src='https://www.google.com/s2/favicons?domain=${new URL(shortcut.url).hostname}&sz=64'">
                    <span>${shortcut.name}</span>
                `;
                
                shortcutsContainer.appendChild(shortcutElement);
            });
            
            // Add event listeners for remove buttons
            document.querySelectorAll('.remove-shortcut').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const index = this.getAttribute('data-index');
                    removeShortcut(index);
                });
            });
        }
        
        // Remove shortcut
        function removeShortcut(index) {
            const shortcuts = JSON.parse(localStorage.getItem('shortcuts')) || defaultShortcuts;
            shortcuts.splice(index, 1);
            localStorage.setItem('shortcuts', JSON.stringify(shortcuts));
            loadShortcuts();
        }
        
        // Update clock and date
        function updateClock() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            
            document.getElementById('clock').textContent = now.toLocaleTimeString('de-DE', timeOptions);
            document.getElementById('date').textContent = now.toLocaleDateString('de-DE', dateOptions);
        }
        
        // Calculate moon phase (enhanced calculation)
        function getMoonPhase(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // Calculation of phase (0-29)
            // Approximation based on "Astronomical Algorithms" by Jean Meeus
            let r = year % 100;
            r %= 19;
            if (r > 9) r -= 19;
            r = ((r * 11) % 30) + month + day;
            if (month < 3) r += 2;
            r -= ((year < 2000) ? 4 : 8.3);
            r = Math.floor(r + 0.5) % 30;
            if (r < 0) r += 30;
            
            // Moon phase icon and text based on the phase
            let moonIcon, moonText;
            
            if (r < 1) {
                moonIcon = '🌑';
                moonText = 'Neumond';
            } else if (r < 7) {
                moonIcon = '🌒';
                moonText = 'Zunehmender Sichelmond';
            } else if (r < 8) {
                moonIcon = '🌓';
                moonText = 'Erstes Viertel';
            } else if (r < 14) {
                moonIcon = '🌔';
                moonText = 'Zunehmender Mond';
            } else if (r < 16) {
                moonIcon = '🌕';
                moonText = 'Vollmond';
            } else if (r < 22) {
                moonIcon = '🌖';
                moonText = 'Abnehmender Mond';
            } else if (r < 23) {
                moonIcon = '🌗';
                moonText = 'Letztes Viertel';
            } else {
                moonIcon = '🌘';
                moonText = 'Abnehmender Sichelmond';
            }
            
            return { icon: moonIcon, text: moonText };
        }
        
        // Weather API function (with enhanced error handling and UI updates)
        async function getWeather(location) {
            try {
                // Update UI to show loading state
                document.querySelector('.weather-desc').textContent = 'Wird geladen...';
                document.querySelector('.weather-icon').classList.add('animate-pulse');
                
                // Using OpenWeatherMap API
                const apiKey = '9de243494c0b295cca9337e1e96b00e2'; // Demo API key
                const url = `https://api.openweathermap.org/data/2.5/weather?q=${location}&units=metric&lang=de&appid=${apiKey}`;
                const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${location}&units=metric&lang=de&appid=${apiKey}`;
                
                // Get weather data
                const response = await fetch(url);
                const data = await response.json();
                
                // For forecast
                const forecastResponse = await fetch(forecastUrl);
                const forecastData = await forecastResponse.json();
                
                if (data.cod === 200) {
                    // Update UI with weather data
                    const temp = Math.round(data.main.temp);
                    const feelsLike = Math.round(data.main.feels_like);
                    const description = data.weather[0].description.charAt(0).toUpperCase() + data.weather[0].description.slice(1);
                    const humidity = data.main.humidity;
                    const windSpeed = Math.round(data.wind.speed * 3.6); // Convert to km/h
                    const pressure = data.main.pressure;
                    const visibility = (data.visibility / 1000).toFixed(1); // Convert to km
                    const clouds = data.clouds.all;
                    
                    // For sunrise and sunset
                    const sunrise = new Date(data.sys.sunrise * 1000);
                    const sunset = new Date(data.sys.sunset * 1000);
                    const sunriseTime = sunrise.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                    const sunsetTime = sunset.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                    
                    // Calculate dew point
                    const dewPoint = Math.round(temp - ((100 - humidity) / 5));
                    
                    // Get weather icon
                    let weatherIcon = '🌤️';
                    const weatherCode = data.weather[0].id;
                    
                    if (weatherCode < 300) {
                        weatherIcon = '⛈️'; // Thunderstorm
                    } else if (weatherCode < 400) {
                        weatherIcon = '🌧️'; // Drizzle
                    } else if (weatherCode < 600) {
                        weatherIcon = '🌧️'; // Rain
                    } else if (weatherCode < 700) {
                        weatherIcon = '❄️'; // Snow
                    } else if (weatherCode < 800) {
                        weatherIcon = '🌫️'; // Atmosphere (fog, mist, etc.)
                    } else if (weatherCode === 800) {
                        weatherIcon = '☀️'; // Clear sky
                    } else if (weatherCode < 900) {
                        weatherIcon = '☁️'; // Clouds
                    }
                    
                    // Update UI elements
                    document.querySelector('.weather-icon').textContent = weatherIcon;
                    document.querySelector('.weather-icon').classList.remove('animate-pulse');
                    document.querySelector('.weather-temp').textContent = `${temp}°C`;
                    document.querySelector('.weather-desc').textContent = description;
                    document.getElementById('feels-like').textContent = `${feelsLike}°C`;
                    document.getElementById('humidity').textContent = `${humidity}%`;
                    document.getElementById('wind').textContent = `${windSpeed} km/h`;
                    document.getElementById('pressure').textContent = `${pressure} hPa`;
                    document.getElementById('visibility').textContent = `${visibility} km`;
                    document.getElementById('clouds').textContent = `${clouds}%`;
                    document.getElementById('dew-point').textContent = `${dewPoint}°C`;
                    document.getElementById('sunrise').textContent = sunriseTime;
                    document.getElementById('sunset').textContent = sunsetTime;
                    
                    // Estimated UV index based on cloud coverage and time of day
                    let uvIndex = 0;
                    const hour = new Date().getHours();
                    const isSunUp = hour >= 7 && hour <= 19;
                    
                    if (isSunUp) {
                        const baseUV = 8; // Base UV value for sunshine
                        uvIndex = Math.round(baseUV * (1 - clouds / 100)); // Reduction based on cloud coverage
                    }
                    
                    document.getElementById('uv-index').textContent = uvIndex;
                    document.getElementById('uv-meter-value').style.width = `${(uvIndex / 11) * 100}%`;
                    
                    // Min/Max temperatures
                    if (forecastData.cod === '200') {
                        const today = new Date().setHours(0, 0, 0, 0);
                        const todayForecasts = forecastData.list.filter(item => {
                            const itemDate = new Date(item.dt * 1000).setHours(0, 0, 0, 0);
                            return itemDate === today;
                        });
                        
                        if (todayForecasts.length > 0) {
                            const temps = todayForecasts.map(item => item.main.temp);
                            const minTemp = Math.round(Math.min(...temps));
                            const maxTemp = Math.round(Math.max(...temps));
                            
                            document.getElementById('min-temp').textContent = `Min: ${minTemp}°C`;
                            document.getElementById('max-temp').textContent = `Max: ${maxTemp}°C`;
                        }
                        
                        // 5-day forecast
                        const forecastContainer = document.getElementById('forecast-container');
                        forecastContainer.innerHTML = '';
                        
                        // Group by days and take only one entry per day
                        const dailyForecasts = {};
                        forecastData.list.forEach(item => {
                            const date = new Date(item.dt * 1000);
                            const day = date.setHours(0, 0, 0, 0);
                            
                            if (!dailyForecasts[day] || date.getHours() === 12) {
                                dailyForecasts[day] = item;
                            }
                        });
                        
                        // Create elements for each day
                        Object.values(dailyForecasts).slice(0, 5).forEach(item => {
                            const date = new Date(item.dt * 1000);
                            const dayName = date.toLocaleDateString('de-DE', { weekday: 'short' });
                            
                            let forecastIcon = '🌤️';
                            const forecastCode = item.weather[0].id;
                            
                            if (forecastCode < 300) {
                                forecastIcon = '⛈️';
                            } else if (forecastCode < 400) {
                                forecastIcon = '🌧️';
                            } else if (forecastCode < 600) {
                                forecastIcon = '🌧️';
                            } else if (forecastCode < 700) {
                                forecastIcon = '❄️';
                            } else if (forecastCode < 800) {
                                forecastIcon = '🌫️';
                            } else if (forecastCode === 800) {
                                forecastIcon = '☀️';
                            } else if (forecastCode < 900) {
                                forecastIcon = '☁️';
                            }
                            
                            const forecastElement = document.createElement('div');
                            forecastElement.className = 'forecast-item';
                            forecastElement.innerHTML = `
                                <div class="forecast-day">${dayName}</div>
                                <div class="forecast-icon">${forecastIcon}</div>
                                <div class="forecast-temp">${Math.round(item.main.temp)}°C</div>
                            `;
                            
                            forecastContainer.appendChild(forecastElement);
                        });
                    }
                    
                    // Update moon phase
                    const moonPhase = getMoonPhase(new Date());
                    document.getElementById('moon-icon').textContent = moonPhase.icon;
                    document.getElementById('moon-phase').textContent = moonPhase.text;
                    
                    // Save location in localStorage
                    localStorage.setItem('weatherLocation', location);
                } else {
                    throw new Error('Stadt nicht gefunden');
                }
            } catch (error) {
                console.error('Fehler beim Abrufen der Wetterdaten:', error);
                document.querySelector('.weather-desc').textContent = 'Stadt nicht gefunden. Versuche es erneut.';
                document.querySelector('.weather-icon').classList.remove('animate-pulse');
                document.querySelector('.weather-icon').textContent = '❓';
            }
        }
        
        // Get random quote from curated list
        function getQuote() {
            try {
                const quotes = [
                    "Der einzige Weg, großartige Arbeit zu leisten, ist zu lieben, was man tut.",
                    "Innovation unterscheidet den Anführer vom Nachfolger.",
                    "Deine Zeit ist begrenzt, also verschwende sie nicht damit, das Leben eines anderen zu leben.",
                    "Die Zukunft gehört denen, die an die Schönheit ihrer Träume glauben.",
                    "Das Leben ist das, was passiert, während du beschäftigt bist, andere Pläne zu machen.",
                    "Die Reise von tausend Meilen beginnt mit einem Schritt.",
                    "Einfachheit ist die ultimative Raffinesse.",
                    "Design ist nicht nur, wie es aussieht und sich anfühlt. Design ist, wie es funktioniert.",
                    "Bleib hungrig, bleib närrisch.",
                    "Denke anders.",
                    "Es ist nicht die stärkste Spezies, die überlebt, auch nicht die intelligenteste, sondern die, die am besten auf Veränderungen reagiert.",
                    "Wissen ist begrenzt, Phantasie umfasst die Welt.",
                    "Das Geheimnis des Erfolgs ist anzufangen.",
                    "Erfolg besteht darin, von einem Misserfolg zum anderen zu gehen, ohne den Enthusiasmus zu verlieren.",
                    "Das Leben ist wie Fahrradfahren. Um die Balance zu halten, musst du in Bewegung bleiben."
                ];
                
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                document.getElementById('quote').textContent = `"${randomQuote}"`;
            } catch (error) {
                console.error('Fehler beim Abrufen des Zitats:', error);
            }
        }
        
        // Load news (simulated function)
        function loadNews() {
            const newsContainer = document.getElementById('news-container');
            newsContainer.innerHTML = '<div class="news-item"><div class="news-title">Nachrichten werden geladen...</div></div>';
            
            // Simulate loading delay for realistic feel
            setTimeout(() => {
                newsContainer.innerHTML = '';
                
                // Sample news (in a real app, this would come from an API)
                const newsItems = [
                    {
                        title: 'Bundesregierung kündigt neue Klimaschutzmaßnahmen an',
                        source: 'Tagesschau',
                        url: 'https://www.tagesschau.de',
                        date: 'Heute'
                    },
                    {
                        title: 'Spannende technologische Innovationen auf der Tech Expo vorgestellt',
                        source: 'Spiegel',
                        url: 'https://www.spiegel.de',
                        date: 'Gestern'
                    },
                    {
                        title: 'Neuer Rekord bei erneuerbaren Energien in Deutschland',
                        source: 'Zeit',
                        url: 'https://www.zeit.de',
                        date: 'Gestern'
                    },
                    {
                        title: 'Fortschritte bei der Impfstoffentwicklung gegen neue Virusvarianten',
                        source: 'Süddeutsche',
                        url: 'https://www.sueddeutsche.de',
                        date: '2 Tage'
                    },
                    {
                        title: 'Wirtschaftsexperten prognostizieren Wachstum für das nächste Quartal',
                        source: 'Focus',
                        url: 'https://www.focus.de',
                        date: '2 Tage'
                    }
                ];
                
                // Create news items
                newsItems.forEach(item => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    newsItem.innerHTML = `
                        <div class="news-title"><a href="${item.url}" target="_blank">${item.title}</a></div>
                        <div class="news-source">
                            <span>${item.source}</span>
                            <span class="news-date">${item.date}</span>
                        </div>
                    `;
                    newsContainer.appendChild(newsItem);
                });
            }, 1000);
        }
        
        // Todo list functionality
        function initTodoList() {
            const todoList = document.getElementById('todo-list');
            const todoForm = document.getElementById('todo-form');
            const todoInput = document.getElementById('todo-input');
            const clearCompleted = document.getElementById('clear-completed');
            
            // Load todos from localStorage
            function loadTodos() {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                todoList.innerHTML = '';
                
                if (todos.length === 0) {
                    todoList.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.7;">Keine Aufgaben vorhanden</div>';
                    return;
                }
                
                todos.forEach((todo, index) => {
                    const todoItem = document.createElement('div');
                    todoItem.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                    todoItem.innerHTML = `
                        <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} data-index="${index}">
                        <span class="todo-text">${todo.text}</span>
                        <button class="todo-delete" data-index="${index}">
                            <span class="material-icons">delete</span>
                        </button>
                    `;
                    todoList.appendChild(todoItem);
                });
                
                // Add event listeners
                document.querySelectorAll('.todo-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const index = this.getAttribute('data-index');
                        toggleTodo(index);
                    });
                });
                
                document.querySelectorAll('.todo-delete').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        deleteTodo(index);
                    });
                });
            }
            
            // Add new todo
            function addTodo(text) {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                todos.push({ text, completed: false });
                localStorage.setItem('todos', JSON.stringify(todos));
                loadTodos();
            }
            
            // Toggle todo completion
            function toggleTodo(index) {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                todos[index].completed = !todos[index].completed;
                localStorage.setItem('todos', JSON.stringify(todos));
                loadTodos();
            }
            
            // Delete todo
            function deleteTodo(index) {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                todos.splice(index, 1);
                localStorage.setItem('todos', JSON.stringify(todos));
                loadTodos();
            }
            
            // Clear completed todos
            function clearCompletedTodos() {
                const todos = JSON.parse(localStorage.getItem('todos')) || [];
                const filteredTodos = todos.filter(todo => !todo.completed);
                localStorage.setItem('todos', JSON.stringify(filteredTodos));
                loadTodos();
            }
            
            // Event listeners
            todoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const text = todoInput.value.trim();
                if (text) {
                    addTodo(text);
                    todoInput.value = '';
                }
            });
            
            clearCompleted.addEventListener('click', clearCompletedTodos);
            
            // Initial load
            loadTodos();
        }
        
        // Notes functionality
        function initNotes() {
            const noteEditor = document.getElementById('note-editor');
            const saveNote = document.getElementById('save-note');
            const clearNote = document.getElementById('clear-note');
            
            // Load note from localStorage
            function loadNote() {
                const note = localStorage.getItem('note') || '';
                noteEditor.value = note;
            }
            
            // Save note to localStorage
            function saveNoteToStorage() {
                localStorage.setItem('note', noteEditor.value);
                // Show success animation
                saveNote.classList.add('animate-pulse');
                setTimeout(() => {
                    saveNote.classList.remove('animate-pulse');
                }, 1000);
            }
            
            // Clear note
            function clearNoteFromStorage() {
                noteEditor.value = '';
                localStorage.removeItem('note');
            }
            
            // Event listeners
            saveNote.addEventListener('click', saveNoteToStorage);
            clearNote.addEventListener('click', clearNoteFromStorage);
            
            // Auto-save on typing (debounced)
            let timeout;
            noteEditor.addEventListener('input', function() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    saveNoteToStorage();
                }, 1000);
            });
            
            // Initial load
            loadNote();
        }
        
        // Calendar functionality
        function initCalendar() {
            const calendarMonth = document.getElementById('calendar-month');
            const calendarWeekdays = document.getElementById('calendar-weekdays');
            const calendarDays = document.getElementById('calendar-days');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();
            
            // Generate weekday headers
            function generateWeekdays() {
                const weekdays = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
                calendarWeekdays.innerHTML = '';
                
                weekdays.forEach(day => {
                    const weekdayElement = document.createElement('div');
                    weekdayElement.className = 'calendar-weekday';
                    weekdayElement.textContent = day;
                    calendarWeekdays.appendChild(weekdayElement);
                });
            }
            
            // Generate calendar days
            function generateCalendar() {
                // Update month/year display
                const monthNames = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 
                                   'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
                calendarMonth.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                
                // Clear previous days
                calendarDays.innerHTML = '';
                
                // Get first day of month and number of days
                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                
                // Get days from previous month
                const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
                
                // Generate previous month days
                for (let i = firstDay - 1; i >= 0; i--) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day other-month';
                    dayElement.textContent = daysInPrevMonth - i;
                    calendarDays.appendChild(dayElement);
                }
                
                // Generate current month days
                const today = new Date();
                const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = i;
                    
                    // Highlight today
                    if (isCurrentMonth && i === today.getDate()) {
                        dayElement.classList.add('today');
                    }
                    
                    // Add random events for demo
                    if (Math.random() < 0.15) {
                        dayElement.classList.add('has-event');
                    }
                    
                    calendarDays.appendChild(dayElement);
                }
                
                // Generate next month days (to fill grid)
                const totalCells = firstDay + daysInMonth;
                const cellsToAdd = 7 - (totalCells % 7);
                
                if (cellsToAdd < 7) {
                    for (let i = 1; i <= cellsToAdd; i++) {
                        const dayElement = document.createElement('div');
                        dayElement.className = 'calendar-day other-month';
                        dayElement.textContent = i;
                        calendarDays.appendChild(dayElement);
                    }
                }
            }
            
            // Navigate to previous month
            function goToPrevMonth() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();
            }
            
            // Navigate to next month
            function goToNextMonth() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar();
            }
            
            // Event listeners
            prevMonthBtn.addEventListener('click', goToPrevMonth);
            nextMonthBtn.addEventListener('click', goToNextMonth);
            
            // Initialize calendar
            generateWeekdays();
            generateCalendar();
        }
        
        // System status functionality (simulated)
        function initSystemStatus() {
            const batteryStatus = document.getElementById('battery-status');
            const batteryLevel = document.getElementById('battery-level');
            const memoryStatus = document.getElementById('memory-status');
            const networkStatus = document.getElementById('network-status');
            const pageLoad = document.getElementById('page-load');
            
            // Simulate battery status
            function updateBatteryStatus() {
                // Generate random battery level between 15% and 100%
                const level = Math.floor(Math.random() * (100 - 15 + 1)) + 15;
                const isCharging = Math.random() > 0.5;
                
                batteryStatus.textContent = `${level}% ${isCharging ? '⚡' : ''}`;
                batteryLevel.style.width = `${level}%`;
                
                if (level < 20) {
                    batteryLevel.parentElement.classList.add('battery-critical');
                } else {
                    batteryLevel.parentElement.classList.remove('battery-critical');
                }
            }
            
            // Simulate memory usage
            function updateMemoryStatus() {
                // Generate random memory usage between 40% and 85%
                const usage = Math.floor(Math.random() * (85 - 40 + 1)) + 40;
                memoryStatus.textContent = `${usage}% verwendet`;
            }
            
            // Simulate network status
            function updateNetworkStatus() {
                const networkTypes = ['WLAN', '4G', '5G'];
                const type = networkTypes[Math.floor(Math.random() * networkTypes.length)];
                
                // Generate random speed
                const speed = Math.floor(Math.random() * 100) + 10;
                networkStatus.textContent = `${type} (${speed} Mbps)`;
            }
            
            // Page load time
            function updatePageLoadTime() {
                const loadTime = (Math.random() * 2 + 0.5).toFixed(2);
                pageLoad.textContent = `${loadTime} Sekunden`;
            }
            
            // Update system status
            function updateSystemStatus() {
                updateBatteryStatus();
                updateMemoryStatus();
                updateNetworkStatus();
                updatePageLoadTime();
            }
            
            // Initialize
            updateSystemStatus();
            
            // Add refresh event
            document.querySelector('.refresh-status').addEventListener('click', function() {
                this.classList.add('animate-spin');
                setTimeout(() => {
                    this.classList.remove('animate-spin');
                    updateSystemStatus();
                }, 1000);
            });
        }
        
        // Voice search functionality
        function initVoiceSearch() {
            const voiceButton = document.getElementById('voice-search');
            const searchInput = document.querySelector('.search-input');
            
            voiceButton.addEventListener('click', function() {
                // Check if browser supports speech recognition
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    
                    recognition.lang = 'de-DE';
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    
                    // Start listening
                    recognition.start();
                    voiceButton.classList.add('speech-recognition-active');
                    
                    // Show feedback to user
                    searchInput.placeholder = 'Ich höre zu...';
                    
                    recognition.onresult = function(event) {
                        const transcript = event.results[0][0].transcript;
                        searchInput.value = transcript;
                        voiceButton.classList.remove('speech-recognition-active');
                        searchInput.placeholder = 'Mit Google suchen';
                        
                        // Auto-submit after a short delay
                        setTimeout(() => {
                            document.getElementById('search-form').submit();
                        }, 500);
                    };
                    
                    recognition.onerror = function() {
                        voiceButton.classList.remove('speech-recognition-active');
                        searchInput.placeholder = 'Mit Google suchen';
                        
                        // Show error message
                        const message = document.getElementById('firefox-message');
                        document.getElementById('message-text').textContent = 'Spracherkennung nicht verfügbar oder erlaubt. Bitte prüfe deine Browsereinstellungen.';
                        message.classList.add('show');
                    };
                    
                    recognition.onend = function() {
                        voiceButton.classList.remove('speech-recognition-active');
                        searchInput.placeholder = 'Mit Google suchen';
                    };
                } else {
                    // Browser doesn't support speech recognition
                    const message = document.getElementById('firefox-message');
                    document.getElementById('message-text').textContent = 'Dein Browser unterstützt keine Spracherkennung.';
                    message.classList.add('show');
                }
            });
        }
        
        // Weather tabs
        function initWeatherTabs() {
            document.querySelectorAll('.weather-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Set active tab
                    document.querySelectorAll('.weather-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active content
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.weather-content').forEach(content => content.classList.remove('active'));
                    
                    if (tabId === 'current') {
                        document.getElementById('current-weather').classList.add('active');
                    } else if (tabId === 'details') {
                        document.getElementById('details-weather').classList.add('active');
                    } else if (tabId === 'forecast') {
                        document.getElementById('forecast-weather').classList.add('active');
                    }
                });
            });
        }
        
        // Show/hide settings panel
        function initSettingsPanel() {
            document.getElementById('settings-btn').addEventListener('click', function() {
                document.getElementById('settings-panel').classList.toggle('show');
            });
            
            // Close settings when clicking outside
            document.addEventListener('click', function(e) {
                const settingsPanel = document.getElementById('settings-panel');
                const settingsBtn = document.getElementById('settings-btn');
                
                if (!settingsPanel.contains(e.target) && e.target !== settingsBtn && !settingsBtn.contains(e.target)) {
                    settingsPanel.classList.remove('show');
                }
            });
        }
        
        // Add new shortcut via settings
        function initShortcutManager() {
            document.getElementById('add-shortcut-btn').addEventListener('click', function() {
                const name = document.getElementById('shortcut-name').value.trim();
                let url = document.getElementById('shortcut-url').value.trim();
                const iconUrl = document.getElementById('shortcut-icon').value.trim();
                
                if (!name || !url) {
                    alert('Bitte gib sowohl Namen als auch URL ein');
                    return;
                }
                
                // Add https:// if not present
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                
                // Get existing shortcuts
                const shortcuts = JSON.parse(localStorage.getItem('shortcuts')) || defaultShortcuts;
                
                // Add new shortcut
                shortcuts.push({
                    name,
                    url,
                    icon: iconUrl || `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}&sz=64` // Use Google's favicon service if none provided
                });
                
                // Save in localStorage
                localStorage.setItem('shortcuts', JSON.stringify(shortcuts));
                
                // Reload shortcuts
                loadShortcuts();
                
                // Clear input fields
                document.getElementById('shortcut-name').value = '';
                document.getElementById('shortcut-url').value = '';
                document.getElementById('shortcut-icon').value = '';
                
                // Hide settings panel
                document.getElementById('settings-panel').classList.remove('show');
            });
            
            // Quick add shortcut button
            document.getElementById('quick-add-shortcut').addEventListener('click', function() {
                document.getElementById('settings-panel').classList.add('show');
                document.getElementById('shortcut-name').focus();
            });
        }
        
        // Weather location input
        function initWeatherInput() {
            document.getElementById('location-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const location = this.value.trim();
                    if (location) {
                        getWeather(location);
                    }
                }
            });
            
            // Refresh weather button
            document.querySelector('.refresh-weather').addEventListener('click', function() {
                const location = document.getElementById('location-input').value.trim() || 'Berlin';
                this.classList.add('animate-spin');
                setTimeout(() => {
                    this.classList.remove('animate-spin');
                    getWeather(location);
                }, 500);
            });
            
            // Get location button
            document.querySelector('.widget-action[title="Standort"]').addEventListener('click', function() {
                if (navigator.geolocation) {
                    this.classList.add('animate-spin');
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.classList.remove('animate-spin');
                            // In a real app, we would convert coordinates to location name via reverse geocoding
                            // For this demo, just use a placeholder
                            document.getElementById('location-input').value = 'Zerbst, Sachsen-Anhalt';
                            getWeather('Zerbst');
                        },
                        (error) => {
                            this.classList.remove('animate-spin');
                            console.error('Geolocation error:', error);
                            const message = document.getElementById('firefox-message');
                            document.getElementById('message-text').textContent = 'Standortabfrage nicht möglich. Bitte erlaube den Zugriff in deinen Browsereinstellungen.';
                            message.classList.add('show');
                        }
                    );
                } else {
                    const message = document.getElementById('firefox-message');
                    document.getElementById('message-text').textContent = 'Dein Browser unterstützt keine Geolokalisierung.';
                    message.classList.add('show');
                }
            });
        }
        
        // Theme settings
        function initThemeSettings() {
            const root = document.documentElement;
            
            // Theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    
                    // Mark as active
                    document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Set theme
                    switch (theme) {
                        case 'firefox':
                            root.style.setProperty('--accent-color', '#ff9500');
                            root.style.setProperty('--accent-gradient', 'linear-gradient(145deg, #ff9500, #e66000)');
                            break;
                        case 'blue':
                            root.style.setProperty('--accent-color', '#0071e3');
                            root.style.setProperty('--accent-gradient', 'linear-gradient(145deg, #0071e3, #005bb5)');
                            break;
                        case 'green':
                            root.style.setProperty('--accent-color', '#28cd41');
                            root.style.setProperty('--accent-gradient', 'linear-gradient(145deg, #28cd41, #1eb234)');
                            break;
                        case 'purple':
                            root.style.setProperty('--accent-color', '#8A2BE2');
                            root.style.setProperty('--accent-gradient', 'linear-gradient(145deg, #8A2BE2, #6a16c8)');
                            break;
                        case 'pink':
                            root.style.setProperty('--accent-color', '#FF1493');
                            root.style.setProperty('--accent-gradient', 'linear-gradient(145deg, #FF1493, #C71585)');
                            break;
                    }
                    
                    // Save theme preference
                    localStorage.setItem('theme', theme);
                });
            });
            
            // Dark/Light mode toggle
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            darkModeToggle.addEventListener('change', function() {
                document.body.classList.toggle('light-mode', this.checked);
                localStorage.setItem('lightMode', this.checked ? 'true' : 'false');
            });
            
            // Search engine selection
            const searchEngineSelect = document.getElementById('search-engine-select');
            searchEngineSelect.addEventListener('change', function() {
                const searchForm = document.getElementById('search-form');
                searchForm.action = this.value;
                localStorage.setItem('searchEngine', this.value);
            });
            
            // Background pattern selection
            const bgRadios = document.querySelectorAll('input[name="bg-pattern"]');
            bgRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const pattern = this.value;
                    
                    // Remove all pattern classes
                    document.body.classList.remove('bg-pattern-dots', 'bg-pattern-grid', 'bg-pattern-waves', 'bg-pattern-circuit', 'bg-gradient-fancy');
                    
                    // Add selected pattern class
                    switch (pattern) {
                        case 'dots':
                            document.body.classList.add('bg-pattern-dots');
                            break;
                        case 'grid':
                            document.body.classList.add('bg-pattern-grid');
                            break;
                        case 'waves':
                            document.body.classList.add('bg-pattern-waves');
                            break;
                        case 'circuit':
                            document.body.classList.add('bg-pattern-circuit');
                            break;
                        case 'gradient':
                            document.body.classList.add('bg-gradient-fancy');
                            break;
                    }
                    
                    // Update preview
                    updateBgPreview(pattern);
                    
                    // Save preference
                    localStorage.setItem('bgPattern', pattern);
                });
            });
            
            // Update background preview
            function updateBgPreview(pattern) {
                const preview = document.getElementById('bg-preview');
                
                // Remove all pattern classes
                preview.classList.remove('bg-pattern-dots', 'bg-pattern-grid', 'bg-pattern-waves', 'bg-pattern-circuit', 'bg-gradient-fancy');
                
                // Add selected pattern class
                switch (pattern) {
                    case 'dots':
                        preview.classList.add('bg-pattern-dots');
                        break;
                    case 'grid':
                        preview.classList.add('bg-pattern-grid');
                        break;
                    case 'waves':
                        preview.classList.add('bg-pattern-waves');
                        break;
                    case 'circuit':
                        preview.classList.add('bg-pattern-circuit');
                        break;
                    case 'gradient':
                        preview.classList.add('bg-gradient-fancy');
                        break;
                }
            }
            
            // Load saved theme settings
            function loadThemeSettings() {
                // Load theme
                const savedTheme = localStorage.getItem('theme') || 'firefox';
                const themeBtn = document.querySelector(`.theme-btn[data-theme="${savedTheme}"]`);
                if (themeBtn) {
                    themeBtn.click();
                }
                
                // Load light/dark mode
                const isLightMode = localStorage.getItem('lightMode') === 'true';
                darkModeToggle.checked = isLightMode;
                document.body.classList.toggle('light-mode', isLightMode);
                
                // Load search engine
                const savedSearchEngine = localStorage.getItem('searchEngine');
                if (savedSearchEngine) {
                    searchEngineSelect.value = savedSearchEngine;
                    document.getElementById('search-form').action = savedSearchEngine;
                }
                
                // Load background pattern
                const savedPattern = localStorage.getItem('bgPattern') || 'dots';
                const bgRadio = document.querySelector(`input[name="bg-pattern"][value="${savedPattern}"]`);
                if (bgRadio) {
                    bgRadio.checked = true;
                    
                    // Apply pattern
                    document.body.classList.remove('bg-pattern-dots', 'bg-pattern-grid', 'bg-pattern-waves', 'bg-pattern-circuit', 'bg-gradient-fancy');
                    
                    switch (savedPattern) {
                        case 'dots':
                            document.body.classList.add('bg-pattern-dots');
                            break;
                        case 'grid':
                            document.body.classList.add('bg-pattern-grid');
                            break;
                        case 'waves':
                            document.body.classList.add('bg-pattern-waves');
                            break;
                        case 'circuit':
                            document.body.classList.add('bg-pattern-circuit');
                            break;
                        case 'gradient':
                            document.body.classList.add('bg-gradient-fancy');
                            break;
                    }
                    
                    // Update preview
                    updateBgPreview(savedPattern);
                }
            }
            
            // Initialize theme settings
            loadThemeSettings();
        }
        
        // Function to handle browser actions - DEMO VERSION
        function initBrowserActions() {
            // Handle Firefox internal page buttons
            document.getElementById('bookmarks-button').addEventListener('click', function(e) {
                e.preventDefault();
                handleBrowserAction('Lesezeichen');
            });
            
            document.getElementById('downloads-button').addEventListener('click', function(e) {
                e.preventDefault();
                handleBrowserAction('Downloads');
            });
            
            document.getElementById('history-button').addEventListener('click', function(e) {
                e.preventDefault();
                handleBrowserAction('Verlauf');
            });
            
            document.getElementById('addons-button').addEventListener('click', function(e) {
                e.preventDefault();
                handleBrowserAction('Add-ons');
            });
            
            // Home button action
            document.getElementById('home-button').addEventListener('click', function(e) {
                e.preventDefault();
                // Just refresh the page for the demo
                window.location.reload();
            });
            
            // Close message button
            document.getElementById('close-message').addEventListener('click', function() {
                document.getElementById('firefox-message').classList.remove('show');
            });
        }
        
        function handleBrowserAction(action) {
            // Create a popup message explaining these features need a Firefox add-on
            const message = document.getElementById('firefox-message');
            document.getElementById('message-text').textContent = `Diese Funktion (${action}) würde in einer echten Firefox-Erweiterung funktionieren. Diese HTML-Seite kann nicht direkt auf Firefox-interne Seiten zugreifen.`;
            message.classList.add('show');
        }
        
        // Page load time calculation
        function calculatePageLoadTime() {
            const loadTime = ((new Date().getTime() - performance.timing.navigationStart) / 1000).toFixed(2);
            document.getElementById('page-load').textContent = `${loadTime} Sekunden`;
        }
        
        // === ENHANCED FEATURES AND NEW WIDGETS ===
        
        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').style.display = 'block';
        });
        
        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('install-prompt').style.display = 'none';
            }
        });
        
        document.getElementById('install-dismiss').addEventListener('click', () => {
            document.getElementById('install-prompt').style.display = 'none';
        });
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('ServiceWorker registration successful');
                    
                    // Listen for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Show update notification
                                showToast('Eine neue Version ist verfügbar!', 'info');
                            }
                        });
                    });
                } catch (error) {
                    console.log('ServiceWorker registration failed:', error);
                }
            });
        }
        
        // Toast Notification System
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <span class="material-icons">${getToastIcon(type)}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">
                    <span class="material-icons">close</span>
                </button>
            `;
            
            // Add toast styles if not already added
            if (!document.querySelector('#toast-styles')) {
                const styles = document.createElement('style');
                styles.id = 'toast-styles';
                styles.textContent = `
                    .toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: var(--card-bg);
                        border: 1px solid var(--card-border);
                        border-radius: var(--card-radius);
                        padding: var(--space-3) var(--space-4);
                        display: flex;
                        align-items: center;
                        gap: var(--space-2);
                        box-shadow: var(--card-hover-shadow);
                        backdrop-filter: blur(10px);
                        z-index: var(--z-toast);
                        animation: slideUp 0.3s ease;
                        max-width: 300px;
                    }
                    .toast-success { border-left: 4px solid var(--success-color); }
                    .toast-error { border-left: 4px solid var(--error-color); }
                    .toast-warning { border-left: 4px solid var(--warning-color); }
                    .toast-info { border-left: 4px solid var(--info-color); }
                    .toast button { background: none; border: none; color: var(--text-secondary); cursor: pointer; }
                `;
                document.head.appendChild(styles);
            }
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), duration);
        }
        
        function getToastIcon(type) {
            const icons = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };
            return icons[type] || 'info';
        }
        
        // Music Player Functionality
        class MusicPlayer {
            constructor() {
                this.audio = new Audio();
                this.isPlaying = false;
                this.currentTime = 0;
                this.duration = 0;
                this.volume = 0.5;
                
                this.initializePlayer();
                this.setupEventListeners();
            }
            
            initializePlayer() {
                this.audio.volume = this.volume;
                
                this.audio.addEventListener('loadedmetadata', () => {
                    this.duration = this.audio.duration;
                    this.updateTimeDisplay();
                });
                
                this.audio.addEventListener('timeupdate', () => {
                    this.currentTime = this.audio.currentTime;
                    this.updateProgress();
                });
                
                this.audio.addEventListener('ended', () => {
                    this.next();
                });
            }
            
            setupEventListeners() {
                document.getElementById('play-btn').addEventListener('click', () => this.togglePlay());
                document.getElementById('prev-btn').addEventListener('click', () => this.previous());
                document.getElementById('next-btn').addEventListener('click', () => this.next());
                document.getElementById('volume-slider').addEventListener('input', (e) => this.setVolume(e.target.value / 100));
                document.getElementById('progress-slider').addEventListener('input', (e) => this.seek(e.target.value / 100));
                
                document.getElementById('music-file-input').addEventListener('change', (e) => {
                    this.loadFile(e.target.files[0]);
                });
            }
            
            loadFile(file) {
                if (file && file.type.startsWith('audio/')) {
                    const url = URL.createObjectURL(file);
                    this.audio.src = url;
                    this.updateTrackInfo(file.name);
                    showToast('Musikdatei geladen!', 'success');
                }
            }
            
            updateTrackInfo(filename) {
                const title = filename.replace(/\.[^/.]+$/, ''); // Remove extension
                document.querySelector('.track-title').textContent = title;
                document.querySelector('.track-artist').textContent = 'Lokale Datei';
            }
            
            togglePlay() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }
            
            play() {
                this.audio.play();
                this.isPlaying = true;
                document.querySelector('#play-btn .material-icons').textContent = 'pause';
            }
            
            pause() {
                this.audio.pause();
                this.isPlaying = false;
                document.querySelector('#play-btn .material-icons').textContent = 'play_arrow';
            }
            
            previous() {
                this.audio.currentTime = 0;
            }
            
            next() {
                this.audio.currentTime = 0;
                this.pause();
            }
            
            setVolume(volume) {
                this.volume = volume;
                this.audio.volume = volume;
            }
            
            seek(percentage) {
                if (this.duration) {
                    this.audio.currentTime = this.duration * percentage;
                }
            }
            
            updateProgress() {
                if (this.duration) {
                    const percentage = (this.currentTime / this.duration) * 100;
                    document.getElementById('progress-fill').style.width = `${percentage}%`;
                    document.getElementById('progress-slider').value = percentage;
                }
                this.updateTimeDisplay();
            }
            
            updateTimeDisplay() {
                document.getElementById('current-time').textContent = this.formatTime(this.currentTime);
                document.getElementById('total-time').textContent = this.formatTime(this.duration);
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }
        }
        
        // Calculator Functionality
        class Calculator {
            constructor() {
                this.expression = '';
                this.result = '0';
                this.shouldResetDisplay = false;
            }
            
            clear() {
                this.expression = '';
                this.result = '0';
                this.updateDisplay();
            }
            
            clearEntry() {
                this.result = '0';
                this.updateDisplay();
            }
            
            deleteLast() {
                if (this.result.length > 1) {
                    this.result = this.result.slice(0, -1);
                } else {
                    this.result = '0';
                }
                this.updateDisplay();
            }
            
            inputNumber(num) {
                if (this.shouldResetDisplay) {
                    this.result = num;
                    this.shouldResetDisplay = false;
                } else {
                    this.result = this.result === '0' ? num : this.result + num;
                }
                this.updateDisplay();
            }
            
            inputDecimal() {
                if (!this.result.includes('.')) {
                    this.result += '.';
                    this.updateDisplay();
                }
            }
            
            inputOperator(op) {
                if (this.expression && !this.shouldResetDisplay) {
                    this.calculate();
                }
                this.expression = this.result + ' ' + (op === '*' ? '×' : op === '/' ? '÷' : op) + ' ';
                this.shouldResetDisplay = true;
                this.updateDisplay();
            }
            
            calculate() {
                try {
                    const expr = this.expression + this.result;
                    const mathExpr = expr.replace(/×/g, '*').replace(/÷/g, '/');
                    const result = Function('"use strict"; return (' + mathExpr + ')')();
                    
                    this.result = this.formatResult(result);
                    this.expression = '';
                    this.shouldResetDisplay = true;
                    this.updateDisplay();
                } catch (error) {
                    this.result = 'Fehler';
                    this.expression = '';
                    this.shouldResetDisplay = true;
                    this.updateDisplay();
                }
            }
            
            formatResult(num) {
                if (isNaN(num) || !isFinite(num)) return 'Fehler';
                if (num.toString().length > 10) {
                    return num.toExponential(5);
                }
                return num.toString();
            }
            
            updateDisplay() {
                document.getElementById('calc-expression').textContent = this.expression;
                document.getElementById('calc-result').textContent = this.result;
            }
        }
        
        // Crypto Tracker Functionality
        class CryptoTracker {
            constructor() {
                this.cryptos = ['bitcoin', 'ethereum', 'cardano', 'polkadot'];
                this.data = {};
                this.lastUpdate = null;
            }
            
            async fetchCryptoPrices() {
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${this.cryptos.join(',')}&vs_currencies=usd&include_24hr_change=true&include_market_cap=true`);
                    const data = await response.json();
                    
                    this.data = data;
                    this.updateDisplay();
                    this.lastUpdate = new Date();
                    this.updateTimestamp();
                    
                    showToast('Kryptodaten aktualisiert!', 'success');
                } catch (error) {
                    console.error('Error fetching crypto data:', error);
                    showToast('Fehler beim Laden der Kryptodaten', 'error');
                }
            }
            
            updateDisplay() {
                const mapping = {
                    'bitcoin': 'btc',
                    'ethereum': 'eth',
                    'cardano': 'ada',
                    'polkadot': 'dot'
                };
                
                let totalMarketCap = 0;
                
                for (const [cryptoId, shortName] of Object.entries(mapping)) {
                    const cryptoData = this.data[cryptoId];
                    if (cryptoData) {
                        const price = cryptoData.usd;
                        const change = cryptoData.usd_24h_change;
                        
                        document.getElementById(`${shortName}-price`).textContent = `$${price.toLocaleString()}`;
                        const changeElement = document.getElementById(`${shortName}-change`);
                        changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
                        changeElement.className = `change ${change > 0 ? 'positive' : 'negative'}`;
                        
                        if (cryptoData.market_cap) {
                            totalMarketCap += cryptoData.market_cap;
                        }
                    }
                }
                
                if (totalMarketCap > 0) {
                    document.getElementById('total-market-cap').textContent = `$${(totalMarketCap / 1e9).toFixed(2)}B`;
                }
            }
            
            updateTimestamp() {
                if (this.lastUpdate) {
                    document.getElementById('crypto-update-time').textContent = this.lastUpdate.toLocaleTimeString('de-DE');
                }
            }
        }
        
        // Widget Toggle Functionality
        function toggleWidget(widgetId) {
            const widget = document.getElementById(widgetId);
            widget.classList.toggle('minimized');
            
            const icon = widget.querySelector('.widget-actions .material-icons');
            if (widget.classList.contains('minimized')) {
                icon.textContent = 'add';
            } else {
                icon.textContent = 'remove';
            }
        }
        
        // Calculator Global Functions
        function clearCalculator() { window.calculator.clear(); }
        function clearEntry() { window.calculator.clearEntry(); }
        function deleteLast() { window.calculator.deleteLast(); }
        function inputNumber(num) { window.calculator.inputNumber(num); }
        function inputDecimal() { window.calculator.inputDecimal(); }
        function inputOperator(op) { window.calculator.inputOperator(op); }
        function calculate() { window.calculator.calculate(); }
        
        // QR Code Generator
        function generateQR() {
            const text = document.getElementById('qr-text-input').value.trim();
            if (!text) {
                showToast('Bitte gib Text oder URL ein', 'warning');
                return;
            }
            
            const qrDisplay = document.getElementById('qr-display');
            const size = 200;
            const apiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}`;
            
            qrDisplay.innerHTML = `
                <div class="qr-code-container">
                    <img src="${apiUrl}" alt="QR Code" style="max-width: 100%; height: auto;">
                </div>
            `;
            
            showToast('QR Code erstellt!', 'success');
        }
        
        function downloadQR() {
            const qrImg = document.querySelector('#qr-display img');
            if (qrImg) {
                const link = document.createElement('a');
                link.href = qrImg.src;
                link.download = 'qr-code.png';
                link.click();
                showToast('QR Code heruntergeladen!', 'success');
            } else {
                showToast('Erst QR Code erstellen!', 'warning');
            }
        }
        
        // Color Palette Functionality
        function addColorToPalette() {
            const color = document.getElementById('color-picker').value;
            const paletteDisplay = document.getElementById('palette-display');
            
            const existingSwatch = paletteDisplay.querySelector(`[data-color="${color}"]`);
            if (existingSwatch) {
                showToast('Farbe bereits in der Palette!', 'warning');
                return;
            }
            
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.setAttribute('data-color', color);
            swatch.style.background = color;
            swatch.innerHTML = `<span class="color-code">${color}</span>`;
            
            swatch.addEventListener('click', () => {
                navigator.clipboard.writeText(color).then(() => {
                    showToast(`Farbe ${color} kopiert!`, 'success');
                });
            });
            
            paletteDisplay.appendChild(swatch);
            showToast('Farbe zur Palette hinzugefügt!', 'success');
        }
        
        function generateRandomPalette() {
            const paletteDisplay = document.getElementById('palette-display');
            paletteDisplay.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                const color = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.setAttribute('data-color', color);
                swatch.style.background = color;
                swatch.innerHTML = `<span class="color-code">${color}</span>`;
                
                swatch.addEventListener('click', () => {
                    navigator.clipboard.writeText(color).then(() => {
                        showToast(`Farbe ${color} kopiert!`, 'success');
                    });
                });
                
                paletteDisplay.appendChild(swatch);
            }
            
            showToast('Zufällige Palette erstellt!', 'success');
        }
        
        // Pomodoro Timer Functionality
        class PomodoroTimer {
            constructor() {
                this.modes = {
                    work: 25 * 60,
                    break: 5 * 60,
                    longbreak: 15 * 60
                };
                this.currentMode = 'work';
                this.timeLeft = this.modes[this.currentMode];
                this.isRunning = false;
                this.interval = null;
                
                this.todayPomodoros = parseInt(localStorage.getItem('todayPomodoros')) || 0;
                this.totalPomodoros = parseInt(localStorage.getItem('totalPomodoros')) || 0;
                
                this.setupEventListeners();
                this.updateDisplay();
                this.updateStats();
            }
            
            setupEventListeners() {
                document.getElementById('timer-start').addEventListener('click', () => this.start());
                document.getElementById('timer-pause').addEventListener('click', () => this.pause());
                document.getElementById('timer-reset').addEventListener('click', () => this.reset());
                
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setMode(e.target.dataset.mode));
                });
            }
            
            start() {
                this.isRunning = true;
                document.getElementById('timer-start').style.display = 'none';
                document.getElementById('timer-pause').style.display = 'inline-flex';
                
                this.interval = setInterval(() => {
                    this.timeLeft--;
                    this.updateDisplay();
                    
                    if (this.timeLeft <= 0) {
                        this.complete();
                    }
                }, 1000);
            }
            
            pause() {
                this.isRunning = false;
                clearInterval(this.interval);
                document.getElementById('timer-start').style.display = 'inline-flex';
                document.getElementById('timer-pause').style.display = 'none';
            }
            
            reset() {
                this.pause();
                this.timeLeft = this.modes[this.currentMode];
                this.updateDisplay();
            }
            
            complete() {
                this.pause();
                
                if (this.currentMode === 'work') {
                    this.todayPomodoros++;
                    this.totalPomodoros++;
                    localStorage.setItem('todayPomodoros', this.todayPomodoros);
                    localStorage.setItem('totalPomodoros', this.totalPomodoros);
                    this.updateStats();
                }
                
                // Show notification
                if (Notification.permission === 'granted') {
                    new Notification('Pomodoro Timer', {
                        body: this.currentMode === 'work' ? 'Zeit für eine Pause!' : 'Zeit für Arbeit!',
                        icon: './manifest.json'
                    });
                }
                
                showToast(`${this.currentMode === 'work' ? 'Arbeitszeit' : 'Pause'} beendet!`, 'success');
                this.reset();
            }
            
            setMode(mode) {
                if (this.modes[mode]) {
                    this.currentMode = mode;
                    this.reset();
                    
                    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                }
            }
            
            updateDisplay() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                document.getElementById('timer-time').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress circle
                const totalTime = this.modes[this.currentMode];
                const progress = ((totalTime - this.timeLeft) / totalTime) * 283;
                document.getElementById('timer-progress').style.strokeDashoffset = 283 - progress;
            }
            
            updateStats() {
                document.getElementById('today-pomodoros').textContent = this.todayPomodoros;
                document.getElementById('total-pomodoros').textContent = this.totalPomodoros;
            }
        }
        
        // Initialize Advanced Features
        function initAdvancedFeatures() {
            window.musicPlayer = new MusicPlayer();
            window.calculator = new Calculator();
            window.cryptoTracker = new CryptoTracker();
            window.pomodoroTimer = new PomodoroTimer();
            
            // Setup crypto refresh button
            document.querySelector('.refresh-crypto').addEventListener('click', () => {
                window.cryptoTracker.fetchCryptoPrices();
            });
            
            // Load crypto data initially
            window.cryptoTracker.fetchCryptoPrices();
            
        // Enhanced Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            // Calculator shortcuts when calculator is visible
            if (document.getElementById('calculator-widget') && !document.getElementById('calculator-widget').classList.contains('minimized')) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    if (e.key >= '0' && e.key <= '9') {
                        e.preventDefault();
                        inputNumber(e.key);
                    } else if (e.key === '.') {
                        e.preventDefault();
                        inputDecimal();
                    } else if (['+', '-', '*', '/'].includes(e.key)) {
                        e.preventDefault();
                        inputOperator(e.key);
                    } else if (e.key === 'Enter' || e.key === '=') {
                        e.preventDefault();
                        calculate();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        clearCalculator();
                    }
                }
            }
            
            // Global shortcuts
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'k':
                        e.preventDefault();
                        document.querySelector('.search-input').focus();
                        break;
                    case ',':
                        e.preventDefault();
                        document.getElementById('settings-panel').classList.toggle('show');
                        break;
                    case 's':
                        e.preventDefault();
                        exportData();
                        break;
                    case 'o':
                        e.preventDefault();
                        document.getElementById('import-file').click();
                        break;
                }
            }
            
            // Widget shortcuts
            if (e.altKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        toggleWidget('weather-widget');
                        break;
                    case '2':
                        e.preventDefault();
                        toggleWidget('clock-widget');
                        break;
                    case '3':
                        e.preventDefault();
                        toggleWidget('todo-widget');
                        break;
                    case '4':
                        e.preventDefault();
                        toggleWidget('calculator-widget');
                        break;
                    case 'm':
                        e.preventDefault();
                        toggleWidget('music-widget');
                        break;
                    case 'c':
                        e.preventDefault();
                        toggleWidget('crypto-widget');
                        break;
                    case 'p':
                        e.preventDefault();
                        if (window.pomodoroTimer.isRunning) {
                            window.pomodoroTimer.pause();
                        } else {
                            window.pomodoroTimer.start();
                        }
                        break;
                }
            }
        });
        
        // Data Export/Import Functionality
        function exportData() {
            const data = {
                shortcuts: JSON.parse(localStorage.getItem('shortcuts')) || [],
                todos: JSON.parse(localStorage.getItem('todos')) || [],
                notes: localStorage.getItem('note') || '',
                weatherLocation: localStorage.getItem('weatherLocation') || '',
                theme: localStorage.getItem('theme') || 'firefox',
                lightMode: localStorage.getItem('lightMode') || 'false',
                searchEngine: localStorage.getItem('searchEngine') || '',
                bgPattern: localStorage.getItem('bgPattern') || 'dots',
                todayPomodoros: localStorage.getItem('todayPomodoros') || '0',
                totalPomodoros: localStorage.getItem('totalPomodoros') || '0',
                chatUsername: localStorage.getItem('chatUsername') || '',
                exportDate: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `firefox-startpage-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Daten exportiert!', 'success');
        }
        
        function importData(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!data.version || !data.exportDate) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    // Import data
                    if (data.shortcuts) localStorage.setItem('shortcuts', JSON.stringify(data.shortcuts));
                    if (data.todos) localStorage.setItem('todos', JSON.stringify(data.todos));
                    if (data.notes) localStorage.setItem('note', data.notes);
                    if (data.weatherLocation) localStorage.setItem('weatherLocation', data.weatherLocation);
                    if (data.theme) localStorage.setItem('theme', data.theme);
                    if (data.lightMode) localStorage.setItem('lightMode', data.lightMode);
                    if (data.searchEngine) localStorage.setItem('searchEngine', data.searchEngine);
                    if (data.bgPattern) localStorage.setItem('bgPattern', data.bgPattern);
                    if (data.todayPomodoros) localStorage.setItem('todayPomodoros', data.todayPomodoros);
                    if (data.totalPomodoros) localStorage.setItem('totalPomodoros', data.totalPomodoros);
                    if (data.chatUsername) localStorage.setItem('chatUsername', data.chatUsername);
                    
                    showToast('Daten importiert! Seite wird neu geladen...', 'success');
                    setTimeout(() => window.location.reload(), 2000);
                    
                } catch (error) {
                    showToast('Fehler beim Importieren der Daten', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }
        
        // Performance Monitoring
        function initPerformanceMonitoring() {
            // Monitor page load performance
            window.addEventListener('load', () => {
                const perfData = performance.getEntriesByType('navigation')[0];
                const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                
                if (loadTime > 3000) {
                    console.warn('Slow page load detected:', loadTime + 'ms');
                }
                
                // Update performance widget if it exists
                const loadTimeElement = document.getElementById('page-load');
                if (loadTimeElement) {
                    loadTimeElement.textContent = `${(loadTime / 1000).toFixed(2)} Sekunden`;
                }
            });
            
            // Monitor memory usage if available
            if ('memory' in performance) {
                setInterval(() => {
                    const memory = performance.memory;
                    const memoryUsage = (memory.usedJSHeapSize / memory.totalJSHeapSize * 100).toFixed(1);
                    
                    const memoryElement = document.getElementById('memory-status');
                    if (memoryElement) {
                        memoryElement.textContent = `${memoryUsage}% verwendet`;
                    }
                }, 5000);
            }
        }
        
        // Enhanced Search Features
        function enhanceSearchFeatures() {
            const searchInput = document.querySelector('.search-input');
            const searchForm = document.getElementById('search-form');
            
            // Add search suggestions
            const suggestions = [
                'Wetter Berlin', 'Google Drive', 'YouTube Music', 'GitHub Repositories',
                'Stack Overflow', 'MDN Web Docs', 'CSS Grid', 'JavaScript ES6',
                'React Documentation', 'Node.js Guide', 'Python Tutorial'
            ];
            
            // Add search history
            const searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
            
            searchForm.addEventListener('submit', (e) => {
                const query = searchInput.value.trim();
                if (query && !searchHistory.includes(query)) {
                    searchHistory.unshift(query);
                    if (searchHistory.length > 10) searchHistory.pop();
                    localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                }
            });
            
            // Quick search commands
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    
                    // Check for special commands
                    if (query.startsWith('!')) {
                        e.preventDefault();
                        handleSpecialCommand(query.substring(1));
                        searchInput.value = '';
                    }
                }
            });
        }
        
        function handleSpecialCommand(command) {
            const cmd = command.toLowerCase();
            
            switch (cmd) {
                case 'export':
                    exportData();
                    break;
                case 'clear':
                    if (confirm('Alle lokalen Daten löschen?')) {
                        localStorage.clear();
                        location.reload();
                    }
                    break;
                case 'theme':
                    document.getElementById('settings-panel').classList.add('show');
                    break;
                case 'calc':
                    toggleWidget('calculator-widget');
                    break;
                case 'music':
                    toggleWidget('music-widget');
                    break;
                case 'timer':
                    toggleWidget('pomodoro-widget');
                    break;
                case 'crypto':
                    window.cryptoTracker.fetchCryptoPrices();
                    break;
                default:
                    showToast(`Unbekannter Befehl: !${command}`, 'warning');
            }
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Load shortcuts
            loadShortcuts();
            
            // Update clock initially and then every second
            updateClock();
            setInterval(updateClock, 1000);
            
            // Load weather
            const savedLocation = localStorage.getItem('weatherLocation') || 'Berlin';
            document.getElementById('location-input').value = savedLocation;
            getWeather(savedLocation);
            
            // Load random quote
            getQuote();
            
            // Initialize components
            initWeatherTabs();
            initSettingsPanel();
            initShortcutManager();
            initWeatherInput();
            initThemeSettings();
            initBrowserActions();
            initTodoList();
            initNotes();
            initCalendar();
            initSystemStatus();
            initVoiceSearch();
            
            // Initialize advanced features
            initAdvancedFeatures();
            
            // Initialize performance monitoring
            initPerformanceMonitoring();
            
            // Enhance search features
            enhanceSearchFeatures();
            
            // Load news
            loadNews();
            
            // Calculate page load time
            calculatePageLoadTime();
            
            // Refresh data periodically
            setInterval(updateClock, 1000); // Update clock every second
            
            // Add window click handler for message popup
            window.addEventListener('click', function(e) {
                const message = document.getElementById('firefox-message');
                if (message.classList.contains('show') && !message.querySelector('.message-content').contains(e.target)) {
                    message.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
