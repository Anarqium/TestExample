<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firefox Startseite - Enhanced</title>
    <meta name="theme-color" content="#ff9500">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRmlyZWZveCBTdGFydHNlaXRlIiwic2hvcnRfbmFtZSI6IkZpcmVmb3giLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMWExYSIsInRoZW1lX2NvbG9yIjoiI2ZmOTUwMCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIyYVdWM1FtOTRQU0l3SURBZ09EQWdPREFpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrUEhKbFkzUWdlRDBpTVRBaUlIazlJakV3SWlCM2FXUjBhRDBpTmpBaUlHaGxhV2RvZEQwaU5qQWlJSEo0UFNJeE1DSWdabWxzYkQwaUkyWm1PVFV3TUNJdlBqd3ZjM1puUGc9PSIsInNpemVzIjoiNjR4NjQiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #f5f5f7;
            --accent-color: #ff9500;
            --accent-gradient: linear-gradient(145deg, #ff9500, #e66000);
            --card-bg: rgba(40, 40, 40, 0.7);
            --card-border: rgba(80, 80, 80, 0.3);
            --nav-bg: rgba(30, 30, 30, 0.9);
            --firefox-red: #e66000;
            --firefox-orange: #ff9500;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            --card-hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            --card-radius: 16px;
            --transition-speed: 0.3s;
            --accent-color-rgb: 255, 149, 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            background: linear-gradient(145deg, #121212, #202020);
            padding-top: 20px;
            padding-bottom: 80px;
            transition: background 0.5s ease;
            position: relative;
        }

        /* WebGL Canvas for background effects */
        #webgl-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            pointer-events: none;
        }

        /* Enhanced animations with Intersection Observer */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .slide-in-left {
            opacity: 0;
            transform: translateX(-50px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide-in-left.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .slide-in-right {
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide-in-right.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* AI Assistant Chat */
        .ai-assistant {
            position: fixed;
            bottom: 150px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 149, 0, 0.3);
            transition: all var(--transition-speed) ease;
            z-index: 1001;
        }

        .ai-assistant:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(255, 149, 0, 0.4);
        }

        .ai-assistant.active {
            background: linear-gradient(145deg, #00ff88, #00cc6a);
        }

        .ai-chat-panel {
            position: fixed;
            bottom: 220px;
            right: 20px;
            width: 380px;
            height: 500px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--card-radius);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transform: translateY(20px);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed) ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .ai-chat-panel.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .ai-chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse-ai 2s infinite;
        }

        @keyframes pulse-ai {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            animation: fadeInMessage 0.3s ease;
        }

        .ai-message.user {
            align-self: flex-end;
            background: var(--accent-gradient);
            color: white;
        }

        .ai-message.assistant {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes fadeInMessage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-chat-input {
            padding: 20px;
            border-top: 1px solid var(--card-border);
            display: flex;
            gap: 10px;
        }

        .ai-input-field {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 12px 16px;
            border-radius: 20px;
            color: var(--text-color);
            outline: none;
        }

        .ai-send-btn {
            background: var(--accent-gradient);
            border: none;
            padding: 12px 16px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Gesture support indicators */
        .gesture-hint {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            pointer-events: none;
        }

        .gesture-hint.show {
            opacity: 1;
        }

        /* Enhanced voice commands indicator */
        .voice-command-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .voice-command-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-command-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .voice-wave {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: voice-pulse 1.5s infinite;
        }

        @keyframes voice-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 149, 0, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(255, 149, 0, 0); }
        }

        /* Smart suggestions */
        .smart-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 0 0 20px 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .smart-suggestions.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s ease;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Data visualization charts */
        .chart-container {
            width: 100%;
            height: 200px;
            margin-top: 15px;
            position: relative;
        }

        /* Weather radar */
        .weather-radar {
            width: 100%;
            height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }

        .radar-sweep {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 50%;
            background: var(--accent-color);
            transform-origin: bottom center;
            animation: radar-sweep 4s linear infinite;
        }

        @keyframes radar-sweep {
            from { transform: translate(-50%, -100%) rotate(0deg); }
            to { transform: translate(-50%, -100%) rotate(360deg); }
        }

        .radar-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 40%, rgba(255, 149, 0, 0.1) 50%);
        }

        /* Copy all other existing styles from the original */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background-color: var(--nav-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            transition: all var(--transition-speed) ease;
        }
        
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            opacity: 0.7;
            transition: all var(--transition-speed);
            text-decoration: none;
            padding: 10px;
            border-radius: 12px;
            width: 65px;
        }
        
        .bottom-nav-item:hover, .bottom-nav-item.active {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }
        
        .bottom-nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .bottom-nav-item span {
            font-size: 11px;
            text-align: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
            flex: 1;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .logo {
            height: 50px;
            transition: transform 0.5s ease;
            position: relative;
            z-index: 2;
        }
        
        .logo:hover {
            transform: rotate(15deg) scale(1.1);
        }
        
        .logo-glow {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 149, 0, 0.3) 0%, rgba(255, 149, 0, 0) 70%);
            animation: pulse 3s infinite alternate;
            z-index: 1;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            100% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        .search-container {
            margin: 30px auto;
            width: 100%;
            max-width: 580px;
            position: relative;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        
        .search-container:hover {
            transform: translateY(-3px);
        }
        
        .search-form {
            display: flex;
            width: 100%;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            font-size: 16px;
            border: none;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), inset 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed) ease;
        }
        
        .search-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-size: 22px;
            opacity: 0.7;
            z-index: 10;
        }
        
        .voice-search {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-size: 22px;
            opacity: 0.7;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .voice-search:hover {
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }
        
        .speech-recognition-active {
            animation: pulse-recording 1.5s infinite;
        }
        
        @keyframes pulse-recording {
            0% { color: var(--text-color); }
            50% { color: #f44336; }
            100% { color: var(--text-color); }
        }
        
        .shortcuts-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 auto 20px;
            max-width: 800px;
            padding: 0 15px;
        }
        
        .shortcuts-title {
            font-size: 18px;
            font-weight: 500;
            opacity: 0.8;
        }
        
        .add-shortcut-quick {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .add-shortcut-quick:hover {
            transform: scale(1.05);
        }
        
        .shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 20px;
            margin: 10px auto 40px;
            max-width: 800px;
            justify-content: center;
            padding: 0 15px;
        }
        
        .shortcut {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90px;
            height: 90px;
            border-radius: var(--card-radius);
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            text-decoration: none;
            color: var(--text-color);
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .shortcut:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
            background-color: rgba(60, 60, 60, 0.7);
            border-color: rgba(var(--accent-color), 0.3);
        }
        
        .shortcut::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .shortcut:hover::before {
            transform: scaleX(1);
        }
        
        .shortcut img {
            width: 36px;
            height: 36px;
            margin-bottom: 10px;
            border-radius: 10px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        
        .shortcut:hover img {
            transform: scale(1.1);
        }
        
        .shortcut span {
            font-size: 12px;
            max-width: 90%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .shortcut .remove-shortcut {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        
        .shortcut:hover .remove-shortcut {
            opacity: 1;
        }
        
        .shortcut .remove-shortcut:hover {
            background-color: #f44336;
            transform: scale(1.1);
        }
        
        .widgets-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .widgets-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .widget {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--card-radius);
            padding: 20px;
            width: 100%;
            max-width: 380px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }
        
        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .widget:hover::before {
            transform: scaleX(1);
        }
        
        .widget:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }
        
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .widget-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .widget-title i {
            color: var(--accent-color);
        }
        
        .widget-actions {
            display: flex;
            gap: 10px;
        }
        
        .widget-action {
            background: none;
            border: none;
            color: var(--text-color);
            opacity: 0.6;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .widget-action:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Add all the other existing styles here... */
        .weather-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .weather-temp {
            font-size: 42px;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .weather-desc {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .weather-details {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .weather-detail {
            text-align: center;
            font-size: 12px;
            opacity: 0.8;
            flex-basis: 33%;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        
        .weather-detail:hover {
            transform: scale(1.05);
            opacity: 1;
        }
        
        .weather-detail-label {
            font-size: 11px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .weather-detail-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .minmax-temp {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }
        
        .divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 15px 0;
            width: 100%;
        }
        
        .moon-phase-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }
        
        .moon-icon {
            font-size: 30px;
            margin-right: 10px;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }
        
        .moon-phase-text {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .weather-tabs {
            display: flex;
            margin-top: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .weather-tab {
            padding: 8px 12px;
            font-size: 14px;
            background: none;
            border: none;
            color: var(--text-color);
            opacity: 0.6;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative;
        }
        
        .weather-tab.active {
            opacity: 1;
        }
        
        .weather-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-gradient);
        }
        
        .weather-tab:hover {
            opacity: 0.8;
        }
        
        .weather-content {
            display: none;
            margin-top: 15px;
        }
        
        .weather-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .weather-icon {
            font-size: 42px;
            margin-right: 15px;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
        }
        
        .uv-meter {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .uv-value {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #22c55e, #eab308, #ef4444, #8b5cf6);
            width: 0%;
            transition: width 1s ease;
        }
        
        .forecast-container {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255,255,255,0.1);
            padding-bottom: 10px;
            gap: 10px;
        }
        
        .forecast-item {
            flex: 0 0 auto;
            text-align: center;
            padding: 10px;
            min-width: 70px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: transform 0.2s;
        }
        
        .forecast-item:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.1);
        }
        
        .forecast-day {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .forecast-icon {
            font-size: 24px;
            margin-bottom: 5px;
            filter: drop-shadow(0 0 3px rgba(255,255,255,0.2));
        }
        
        .forecast-temp {
            font-size: 13px;
            font-weight: 500;
        }

        /* Settings and other components styles would continue here... */
        .settings-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            z-index: 900;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .settings-btn:hover {
            transform: rotate(30deg);
            background-color: rgba(60, 60, 60, 0.7);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .widgets-row {
                flex-direction: column;
                align-items: center;
            }
            
            .widget {
                max-width: 100%;
                margin-bottom: 0;
            }
            
            .search-container {
                max-width: 90%;
            }
            
            .shortcuts {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 15px;
            }
            
            .shortcut {
                width: 80px;
                height: 80px;
            }
            
            .ai-chat-panel {
                width: 90%;
                right: 5%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="bg-pattern-dots">
    <!-- WebGL Canvas for background effects -->
    <canvas id="webgl-canvas"></canvas>

    <!-- Gesture hint -->
    <div class="gesture-hint" id="gesture-hint">
        Swipe left/right to navigate
    </div>

    <!-- Voice command overlay -->
    <div class="voice-command-overlay" id="voice-overlay">
        <div class="voice-command-content">
            <div class="voice-wave">
                <span class="material-icons">mic</span>
            </div>
            <h3>Listening for voice commands...</h3>
            <p>Try: "Open YouTube", "What's the weather?", "Add note"</p>
        </div>
    </div>

    <!-- AI Assistant -->
    <div class="ai-assistant" id="ai-assistant">
        <span class="material-icons">smart_toy</span>
    </div>

    <!-- AI Chat Panel -->
    <div class="ai-chat-panel" id="ai-chat-panel">
        <div class="ai-chat-header">
            <span class="material-icons">smart_toy</span>
            <div>
                <div style="font-weight: 500;">AI Assistant</div>
                <div style="font-size: 12px; opacity: 0.7; display: flex; align-items: center; gap: 5px;">
                    <div class="ai-status-indicator"></div>
                    Online
                </div>
            </div>
        </div>
        <div class="ai-chat-messages" id="ai-messages">
            <div class="ai-message assistant">
                Hi! I'm your AI assistant. I can help you with weather, shortcuts, notes, and more. Try asking me something!
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" class="ai-input-field" id="ai-input" placeholder="Ask me anything...">
            <button class="ai-send-btn" id="ai-send">
                <span class="material-icons">send</span>
            </button>
        </div>
    </div>

    <!-- Firefox Logo with glow effect -->
    <div class="logo-container fade-in">
        <div class="logo-glow"></div>
        <img src="https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg" alt="Firefox Logo" class="logo">
    </div>

    <div class="container">
        <!-- Enhanced Search with smart suggestions -->
        <div class="search-container slide-in-left">
            <form class="search-form" id="search-form" action="https://www.google.com/search" method="GET">
                <span class="material-icons search-icon">search</span>
                <input type="text" name="q" class="search-input" placeholder="Mit Google suchen oder Sprachbefehl" autocomplete="off" id="main-search">
                <button type="button" class="material-icons voice-search" id="voice-search">mic</button>
            </form>
            <div class="smart-suggestions" id="smart-suggestions">
                <!-- Smart suggestions will appear here -->
            </div>
        </div>
        
        <!-- Shortcuts section -->
        <div class="shortcuts-heading slide-in-right">
            <div class="shortcuts-title">Schnellzugriff</div>
            <button class="add-shortcut-quick" id="quick-add-shortcut">
                <span class="material-icons">add_circle</span> Hinzufügen
            </button>
        </div>
        
        <div class="shortcuts fade-in" id="shortcuts">
            <!-- Shortcuts will be dynamically generated -->
        </div>
        
        <!-- Enhanced Widgets Container -->
        <div class="widgets-container">
            <!-- First row of widgets -->
            <div class="widgets-row">
                <!-- Enhanced Weather Widget -->
                <div class="widget slide-in-left">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">cloud</span> Wetter
                        </div>
                        <div class="widget-actions">
                            <button class="widget-action refresh-weather" title="Aktualisieren">
                                <span class="material-icons">refresh</span>
                            </button>
                            <div class="tooltip">
                                <button class="widget-action" title="Standort">
                                    <span class="material-icons">location_on</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <input type="text" id="location-input" class="url-input" placeholder="Ort eingeben" value="Berlin">
                    
                    <div class="weather-tabs">
                        <button class="weather-tab active" data-tab="current">Aktuell</button>
                        <button class="weather-tab" data-tab="details">Details</button>
                        <button class="weather-tab" data-tab="forecast">Vorhersage</button>
                        <button class="weather-tab" data-tab="radar">Radar</button>
                    </div>
                    
                    <div id="current-weather" class="weather-content active">
                        <div class="weather-info">
                            <div class="weather-icon">🌤️</div>
                            <div>
                                <div class="weather-temp">--°C</div>
                                <div class="weather-desc">Wird geladen...</div>
                            </div>
                        </div>
                        
                        <div class="minmax-temp">
                            <span id="min-temp">Min: --°C</span>
                            <span id="max-temp">Max: --°C</span>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="weather-details">
                            <div class="weather-detail">
                                <div class="weather-detail-label">Luftfeuchtigkeit</div>
                                <div class="weather-detail-value" id="humidity">--%</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Wind</div>
                                <div class="weather-detail-value" id="wind">-- km/h</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Luftdruck</div>
                                <div class="weather-detail-value" id="pressure">-- hPa</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Sichtweite</div>
                                <div class="weather-detail-value" id="visibility">-- km</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">UV-Index</div>
                                <div class="weather-detail-value" id="uv-index">--</div>
                                <div class="uv-meter">
                                    <div class="uv-value" id="uv-meter-value"></div>
                                </div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">Gefühlt</div>
                                <div class="weather-detail-value" id="feels-like">--°C</div>
                            </div>
                        </div>

                        <!-- Weather trend chart -->
                        <div class="chart-container" id="weather-chart">
                            <canvas id="weather-trend-canvas" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div id="details-weather" class="weather-content">
                        <div class="moon-phase-container">
                            <div class="moon-icon" id="moon-icon">🌕</div>
                            <div class="moon-phase-text" id="moon-phase">Mondphase wird geladen...</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div>
                            <div><strong>Sonnenaufgang:</strong> <span id="sunrise">--:--</span></div>
                            <div><strong>Sonnenuntergang:</strong> <span id="sunset">--:--</span></div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div>
                            <div><strong>Taupunkt:</strong> <span id="dew-point">--°C</span></div>
                            <div><strong>Wolkenbedeckung:</strong> <span id="clouds">--%</span></div>
                        </div>
                    </div>
                    
                    <div id="forecast-weather" class="weather-content">
                        <div class="forecast-container" id="forecast-container">
                            <!-- Forecast will be dynamically generated -->
                        </div>
                    </div>

                    <div id="radar-weather" class="weather-content">
                        <div class="weather-radar">
                            <div class="radar-dots"></div>
                            <div class="radar-sweep"></div>
                        </div>
                        <p style="text-align: center; margin-top: 10px; font-size: 12px; opacity: 0.7;">
                            Simulated radar view
                        </p>
                    </div>
                </div>
                
                <!-- Enhanced Clock & Date Widget -->
                <div class="widget slide-in-right">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">access_time</span> Datum & Uhrzeit
                        </div>
                    </div>
                    <div class="clock-widget">
                        <div class="clock" id="clock">00:00:00</div>
                        <div class="date" id="date">Wird geladen...</div>
                        <div class="quote" id="quote">Lade Zitat des Tages...</div>
                        
                        <!-- Time zone selection -->
                        <div style="margin-top: 15px;">
                            <select id="timezone-select" style="background: rgba(255,255,255,0.1); border: none; padding: 8px; border-radius: 8px; color: white;">
                                <option value="Europe/Berlin">Berlin</option>
                                <option value="America/New_York">New York</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                                <option value="Australia/Sydney">Sydney</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Bottom Navigation Bar -->
    <div class="bottom-nav">
        <a href="#" class="bottom-nav-item active" id="home-button">
            <span class="material-icons">home</span>
            <span>Startseite</span>
        </a>
        <a href="#" class="bottom-nav-item" id="bookmarks-button">
            <span class="material-icons">bookmark</span>
            <span>Lesezeichen</span>
        </a>
        <a href="#" class="bottom-nav-item" id="downloads-button">
            <span class="material-icons">download</span>
            <span>Downloads</span>
        </a>
        <a href="#" class="bottom-nav-item" id="history-button">
            <span class="material-icons">history</span>
            <span>Verlauf</span>
        </a>
        <a href="#" class="bottom-nav-item" id="addons-button">
            <span class="material-icons">extension</span>
            <span>Add-ons</span>
        </a>
    </div>
    
    <!-- Settings Button -->
    <div class="settings-btn" id="settings-btn">
        <span class="material-icons">settings</span>
    </div>

    <script>
        // Enhanced Web Technologies Integration
        class EnhancedFirefoxStartpage {
            constructor() {
                this.init();
                this.initWebGL();
                this.initIntersectionObserver();
                this.initGestureSupport();
                this.initSmartSuggestions();
                this.initVoiceCommands();
                this.initAIAssistant();
                this.initPWA();
                this.registerServiceWorker();
            }

            init() {
                // Load shortcuts with default values
                this.defaultShortcuts = [
                    { name: 'YouTube', url: 'https://youtube.com', icon: 'https://www.youtube.com/favicon.ico' },
                    { name: 'Gmail', url: 'https://mail.google.com', icon: 'https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico' },
                    { name: 'Twitter', url: 'https://twitter.com', icon: 'https://twitter.com/favicon.ico' },
                    { name: 'GitHub', url: 'https://github.com', icon: 'https://github.com/favicon.ico' },
                    { name: 'Netflix', url: 'https://netflix.com', icon: 'https://assets.nflxext.com/us/ffe/siteui/common/icons/nficon2016.ico' },
                    { name: 'Amazon', url: 'https://amazon.com', icon: 'https://www.amazon.com/favicon.ico' },
                    { name: 'Reddit', url: 'https://reddit.com', icon: 'https://www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png' },
                    { name: 'Wikipedia', url: 'https://wikipedia.org', icon: 'https://en.wikipedia.org/static/favicon/wikipedia.ico' }
                ];

                this.loadShortcuts();
                this.updateClock();
                this.getWeather('Berlin');
                this.getQuote();
                this.initWeatherChart();
                
                // Update clock every second
                setInterval(() => this.updateClock(), 1000);
            }

            // WebGL Background Effects
            initWebGL() {
                const canvas = document.getElementById('webgl-canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (!gl) {
                    console.log('WebGL not supported');
                    return;
                }

                this.setupWebGLScene(gl, canvas);
            }

            setupWebGLScene(gl, canvas) {
                const resizeCanvas = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    gl.viewport(0, 0, canvas.width, canvas.height);
                };
                
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);

                // Simple particle system
                const vertexShaderSource = `
                    attribute vec2 position;
                    uniform float time;
                    uniform vec2 mouse;
                    varying float vAlpha;
                    
                    void main() {
                        vec2 pos = position;
                        pos.x += sin(time * 0.001 + position.y * 10.0) * 0.1;
                        pos.y += cos(time * 0.001 + position.x * 10.0) * 0.1;
                        
                        float dist = distance(pos, mouse);
                        vAlpha = 1.0 - smoothstep(0.0, 0.5, dist);
                        
                        gl_Position = vec4(pos, 0.0, 1.0);
                        gl_PointSize = 2.0 + vAlpha * 3.0;
                    }
                `;

                const fragmentShaderSource = `
                    precision mediump float;
                    varying float vAlpha;
                    
                    void main() {
                        gl_FragColor = vec4(1.0, 0.58, 0.0, vAlpha * 0.3);
                    }
                `;

                const createShader = (type, source) => {
                    const shader = gl.createShader(type);
                    gl.shaderSource(shader, source);
                    gl.compileShader(shader);
                    return shader;
                };

                const vertexShader = createShader(gl.VERTEX_SHADER, vertexShaderSource);
                const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentShaderSource);
                
                const program = gl.createProgram();
                gl.attachShader(program, vertexShader);
                gl.attachShader(program, fragmentShader);
                gl.linkProgram(program);
                gl.useProgram(program);

                // Create particle positions
                const particles = [];
                for (let i = 0; i < 50; i++) {
                    particles.push(
                        (Math.random() - 0.5) * 2, // x
                        (Math.random() - 0.5) * 2  // y
                    );
                }

                const positionBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(particles), gl.STATIC_DRAW);

                const positionLocation = gl.getAttribLocation(program, 'position');
                const timeLocation = gl.getUniformLocation(program, 'time');
                const mouseLocation = gl.getUniformLocation(program, 'mouse');

                gl.enableVertexAttribArray(positionLocation);
                gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

                let mouseX = 0, mouseY = 0;
                canvas.addEventListener('mousemove', (e) => {
                    mouseX = (e.clientX / canvas.width) * 2 - 1;
                    mouseY = -((e.clientY / canvas.height) * 2 - 1);
                });

                const render = (time) => {
                    gl.clearColor(0, 0, 0, 0);
                    gl.clear(gl.COLOR_BUFFER_BIT);

                    gl.uniform1f(timeLocation, time);
                    gl.uniform2f(mouseLocation, mouseX, mouseY);

                    gl.enable(gl.BLEND);
                    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

                    gl.drawArrays(gl.POINTS, 0, particles.length / 2);
                    requestAnimationFrame(render);
                };

                requestAnimationFrame(render);
            }

            // Intersection Observer for animations
            initIntersectionObserver() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, observerOptions);

                // Observe all elements with animation classes
                document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right').forEach(el => {
                    observer.observe(el);
                });
            }

            // Touch gesture support
            initGestureSupport() {
                let startX, startY, currentWidget = 0;
                const widgets = document.querySelectorAll('.widget');

                document.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                }, { passive: true });

                document.addEventListener('touchmove', (e) => {
                    if (!startX || !startY) return;

                    const currentX = e.touches[0].clientX;
                    const currentY = e.touches[0].clientY;
                    const diffX = startX - currentX;
                    const diffY = startY - currentY;

                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                        const hint = document.getElementById('gesture-hint');
                        hint.classList.add('show');
                        setTimeout(() => hint.classList.remove('show'), 2000);

                        if (diffX > 0) {
                            // Swipe left - next widget
                            this.highlightNextWidget(1);
                        } else {
                            // Swipe right - previous widget
                            this.highlightNextWidget(-1);
                        }
                        
                        startX = startY = null;
                    }
                }, { passive: true });
            }

            highlightNextWidget(direction) {
                const widgets = document.querySelectorAll('.widget');
                if (widgets.length === 0) return;

                // Remove current highlight
                widgets.forEach(widget => widget.style.outline = '');

                // Calculate next widget
                this.currentWidgetIndex = (this.currentWidgetIndex || 0) + direction;
                if (this.currentWidgetIndex >= widgets.length) this.currentWidgetIndex = 0;
                if (this.currentWidgetIndex < 0) this.currentWidgetIndex = widgets.length - 1;

                // Highlight widget
                widgets[this.currentWidgetIndex].style.outline = '2px solid var(--accent-color)';
                widgets[this.currentWidgetIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Remove highlight after 2 seconds
                setTimeout(() => {
                    widgets[this.currentWidgetIndex].style.outline = '';
                }, 2000);
            }

            // Smart search suggestions
            initSmartSuggestions() {
                const searchInput = document.getElementById('main-search');
                const suggestionsContainer = document.getElementById('smart-suggestions');
                
                const commonSearches = [
                    { text: 'YouTube', icon: 'video_library', action: () => window.open('https://youtube.com') },
                    { text: 'GitHub', icon: 'code', action: () => window.open('https://github.com') },
                    { text: 'Weather Berlin', icon: 'cloud', action: () => this.getWeather('Berlin') },
                    { text: 'News', icon: 'newspaper', action: () => window.open('https://news.google.com') },
                    { text: 'Calculator', icon: 'calculate', action: () => this.openCalculator() },
                    { text: 'Timer', icon: 'timer', action: () => this.openTimer() }
                ];

                let debounceTimer;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        const query = e.target.value.toLowerCase().trim();
                        
                        if (query.length < 2) {
                            suggestionsContainer.classList.remove('show');
                            return;
                        }

                        const matches = commonSearches.filter(item => 
                            item.text.toLowerCase().includes(query)
                        );

                        this.showSuggestions(matches, suggestionsContainer);
                    }, 150);
                });

                // Hide suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                        suggestionsContainer.classList.remove('show');
                    }
                });
            }

            showSuggestions(suggestions, container) {
                if (suggestions.length === 0) {
                    container.classList.remove('show');
                    return;
                }

                container.innerHTML = suggestions.map(suggestion => `
                    <div class="suggestion-item" data-action="${suggestion.text}">
                        <span class="material-icons">${suggestion.icon}</span>
                        <span>${suggestion.text}</span>
                    </div>
                `).join('');

                // Add click handlers
                container.querySelectorAll('.suggestion-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        suggestions[index].action();
                        container.classList.remove('show');
                    });
                });

                container.classList.add('show');
            }

            // Enhanced voice commands
            initVoiceCommands() {
                const voiceButton = document.getElementById('voice-search');
                const overlay = document.getElementById('voice-overlay');

                voiceButton.addEventListener('click', () => {
                    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                        this.startVoiceRecognition(overlay);
                    } else {
                        this.showNotification('Voice recognition not supported in this browser');
                    }
                });
            }

            startVoiceRecognition(overlay) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'de-DE';

                overlay.classList.add('show');

                recognition.onresult = (event) => {
                    const command = event.results[0][0].transcript.toLowerCase();
                    this.processVoiceCommand(command);
                    overlay.classList.remove('show');
                };

                recognition.onerror = () => {
                    overlay.classList.remove('show');
                    this.showNotification('Voice recognition error');
                };

                recognition.onend = () => {
                    overlay.classList.remove('show');
                };

                recognition.start();
            }

            processVoiceCommand(command) {
                console.log('Voice command:', command);
                
                if (command.includes('youtube') || command.includes('video')) {
                    window.open('https://youtube.com');
                    this.showNotification('Opening YouTube');
                } else if (command.includes('wetter') || command.includes('weather')) {
                    this.getWeather('Berlin');
                    this.showNotification('Updating weather');
                } else if (command.includes('zeit') || command.includes('time')) {
                    this.speak(`Es ist ${new Date().toLocaleTimeString('de-DE')}`);
                } else if (command.includes('notiz') || command.includes('note')) {
                    document.querySelector('.widget:nth-child(3)')?.scrollIntoView({ behavior: 'smooth' });
                    this.showNotification('Opening notes');
                } else {
                    // Default: search
                    document.getElementById('main-search').value = command;
                    document.getElementById('search-form').submit();
                }
            }

            speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'de-DE';
                    speechSynthesis.speak(utterance);
                }
            }

            // AI Assistant
            initAIAssistant() {
                const aiButton = document.getElementById('ai-assistant');
                const aiPanel = document.getElementById('ai-chat-panel');
                const aiInput = document.getElementById('ai-input');
                const aiSend = document.getElementById('ai-send');
                const aiMessages = document.getElementById('ai-messages');

                aiButton.addEventListener('click', () => {
                    aiPanel.classList.toggle('show');
                    if (aiPanel.classList.contains('show')) {
                        aiInput.focus();
                        aiButton.classList.add('active');
                    } else {
                        aiButton.classList.remove('active');
                    }
                });

                const sendMessage = () => {
                    const message = aiInput.value.trim();
                    if (!message) return;

                    this.addAIMessage(message, 'user', aiMessages);
                    aiInput.value = '';

                    // Simulate AI response
                    setTimeout(() => {
                        const response = this.generateAIResponse(message);
                        this.addAIMessage(response, 'assistant', aiMessages);
                    }, 1000);
                };

                aiSend.addEventListener('click', sendMessage);
                aiInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
            }

            addAIMessage(text, sender, container) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `ai-message ${sender}`;
                messageDiv.textContent = text;
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }

            generateAIResponse(message) {
                const responses = {
                    'weather': 'I can help you check the weather! The current weather widget shows real-time data for your selected location.',
                    'time': `The current time is ${new Date().toLocaleTimeString('de-DE')}.`,
                    'shortcuts': 'You can add new shortcuts by clicking the + button in the shortcuts section, or through the settings panel.',
                    'help': 'I can help you with weather updates, managing shortcuts, taking notes, and navigating the startpage. What would you like to do?',
                    'default': 'I understand you\'re asking about something specific. As an AI assistant for this Firefox startpage, I can help with weather, shortcuts, notes, and general navigation. What can I help you with today?'
                };

                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('wetter') || lowerMessage.includes('weather')) {
                    return responses.weather;
                } else if (lowerMessage.includes('zeit') || lowerMessage.includes('time')) {
                    return responses.time;
                } else if (lowerMessage.includes('shortcut') || lowerMessage.includes('verknüpfung')) {
                    return responses.shortcuts;
                } else if (lowerMessage.includes('help') || lowerMessage.includes('hilfe')) {
                    return responses.help;
                } else {
                    return responses.default;
                }
            }

            // Progressive Web App features
            initPWA() {
                // Add to home screen prompt
                let deferredPrompt;
                
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    this.showInstallPrompt();
                });

                // Handle app installed
                window.addEventListener('appinstalled', () => {
                    this.showNotification('Firefox Startpage installed successfully!');
                });
            }

            showInstallPrompt() {
                const installDiv = document.createElement('div');
                installDiv.innerHTML = `
                    <div style="position: fixed; top: 20px; right: 20px; background: var(--card-bg); padding: 15px; border-radius: 10px; z-index: 1000; backdrop-filter: blur(10px);">
                        <p style="margin-bottom: 10px;">Install Firefox Startpage as an app?</p>
                        <button id="install-btn" style="background: var(--accent-gradient); border: none; padding: 8px 15px; border-radius: 5px; color: white; cursor: pointer; margin-right: 10px;">Install</button>
                        <button id="dismiss-btn" style="background: rgba(255,255,255,0.1); border: none; padding: 8px 15px; border-radius: 5px; color: white; cursor: pointer;">Dismiss</button>
                    </div>
                `;
                
                document.body.appendChild(installDiv);

                document.getElementById('install-btn').addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`User response to the install prompt: ${outcome}`);
                        deferredPrompt = null;
                    }
                    installDiv.remove();
                });

                document.getElementById('dismiss-btn').addEventListener('click', () => {
                    installDiv.remove();
                });

                // Auto-dismiss after 10 seconds
                setTimeout(() => installDiv.remove(), 10000);
            }

            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    // Register a simple service worker for caching
                    const swCode = `
                        const CACHE_NAME = 'firefox-startpage-v1';
                        const urlsToCache = [
                            '/',
                            '/index.html',
                            'https://fonts.googleapis.com/icon?family=Material+Icons',
                            'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap'
                        ];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => response || fetch(event.request))
                            );
                        });
                    `;

                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);

                    navigator.serviceWorker.register(swUrl)
                        .then(() => console.log('Service Worker registered'))
                        .catch((error) => console.log('Service Worker registration failed:', error));
                }
            }

            // Weather chart using Canvas
            initWeatherChart() {
                const canvas = document.getElementById('weather-trend-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = 400;
                canvas.height = 200;

                // Generate sample temperature data for the last 24 hours
                const now = new Date();
                const temps = [];
                for (let i = 0; i < 24; i++) {
                    const temp = 15 + Math.sin((i - 12) / 3) * 8 + Math.random() * 4;
                    temps.push(temp);
                }

                this.drawWeatherChart(ctx, temps, canvas.width, canvas.height);
            }

            drawWeatherChart(ctx, data, width, height) {
                ctx.clearRect(0, 0, width, height);
                
                const padding = 40;
                const chartWidth = width - padding * 2;
                const chartHeight = height - padding * 2;
                
                const minTemp = Math.min(...data);
                const maxTemp = Math.max(...data);
                const tempRange = maxTemp - minTemp;

                // Draw grid
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (i / 5) * chartHeight;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }

                // Draw temperature curve
                ctx.strokeStyle = '#ff9500';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                data.forEach((temp, i) => {
                    const x = padding + (i / (data.length - 1)) * chartWidth;
                    const y = padding + chartHeight - ((temp - minTemp) / tempRange) * chartHeight;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();

                // Add labels
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '12px Inter';
                ctx.fillText(`${maxTemp.toFixed(1)}°C`, 5, padding + 5);
                ctx.fillText(`${minTemp.toFixed(1)}°C`, 5, height - padding + 15);
                ctx.fillText('24h', width - 30, height - 10);
            }

            // Utility methods
            showNotification(message) {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Firefox Startpage', { body: message });
                } else {
                    // Fallback to custom notification
                    const notification = document.createElement('div');
                    notification.innerHTML = `
                        <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--card-bg); padding: 15px 20px; border-radius: 10px; z-index: 2000; backdrop-filter: blur(10px); animation: fadeInMessage 0.3s ease;">
                            ${message}
                        </div>
                    `;
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 3000);
                }
            }

            openCalculator() {
                const calc = prompt('Enter calculation:');
                if (calc) {
                    try {
                        const result = eval(calc.replace(/[^0-9+\-*/().]/g, ''));
                        this.showNotification(`Result: ${result}`);
                    } catch (e) {
                        this.showNotification('Invalid calculation');
                    }
                }
            }

            openTimer() {
                const minutes = prompt('Timer minutes:');
                if (minutes && !isNaN(minutes)) {
                    const ms = parseInt(minutes) * 60 * 1000;
                    this.showNotification(`Timer set for ${minutes} minutes`);
                    setTimeout(() => {
                        this.showNotification('Timer finished!');
                        this.speak('Timer finished');
                    }, ms);
                }
            }

            // Basic implementations for existing functionality
            loadShortcuts() {
                const shortcuts = JSON.parse(localStorage.getItem('shortcuts')) || this.defaultShortcuts;
                const container = document.getElementById('shortcuts');
                container.innerHTML = '';
                
                shortcuts.forEach((shortcut, index) => {
                    const element = document.createElement('a');
                    element.className = 'shortcut';
                    element.href = shortcut.url;
                    element.innerHTML = `
                        <div class="remove-shortcut" data-index="${index}">×</div>
                        <img src="${shortcut.icon}" alt="${shortcut.name}" onerror="this.src='https://www.google.com/s2/favicons?domain=${new URL(shortcut.url).hostname}&sz=64'">
                        <span>${shortcut.name}</span>
                    `;
                    container.appendChild(element);
                });
            }

            updateClock() {
                const now = new Date();
                const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                
                document.getElementById('clock').textContent = now.toLocaleTimeString('de-DE', timeOptions);
                document.getElementById('date').textContent = now.toLocaleDateString('de-DE', dateOptions);
            }

            async getWeather(location) {
                try {
                    // Mock weather data for demo
                    const temp = Math.round(15 + Math.random() * 15);
                    const humidity = Math.round(40 + Math.random() * 40);
                    const wind = Math.round(5 + Math.random() * 15);
                    
                    document.querySelector('.weather-temp').textContent = `${temp}°C`;
                    document.querySelector('.weather-desc').textContent = 'Teilweise bewölkt';
                    document.getElementById('humidity').textContent = `${humidity}%`;
                    document.getElementById('wind').textContent = `${wind} km/h`;
                    document.getElementById('feels-like').textContent = `${temp + Math.round(Math.random() * 4 - 2)}°C`;
                    
                    // Update chart with new data
                    this.initWeatherChart();
                } catch (error) {
                    console.error('Weather API error:', error);
                }
            }

            getQuote() {
                const quotes = [
                    "Innovation unterscheidet den Anführer vom Nachfolger.",
                    "Deine Zeit ist begrenzt, also verschwende sie nicht.",
                    "Die Zukunft gehört denen, die an die Schönheit ihrer Träume glauben.",
                    "Design ist nicht nur, wie es aussieht. Design ist, wie es funktioniert.",
                    "Bleib hungrig, bleib närrisch."
                ];
                
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                document.getElementById('quote').textContent = `"${randomQuote}"`;
            }
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Initialize the enhanced startpage
        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedFirefoxStartpage();
        });

        // Add basic weather tab functionality
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.weather-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.weather-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Hide all content
                    document.querySelectorAll('.weather-content').forEach(content => content.classList.remove('active'));
                    
                    // Show selected content
                    const tabId = this.getAttribute('data-tab');
                    const contentId = tabId === 'current' ? 'current-weather' : 
                                     tabId === 'details' ? 'details-weather' : 
                                     tabId === 'forecast' ? 'forecast-weather' : 'radar-weather';
                    document.getElementById(contentId).classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
