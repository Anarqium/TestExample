<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Live HTML Editor mit Gemini AI</title>
    
    <!-- CSS für ein modernes & benutzerfreundliches Design -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;700&display=swap');

        :root {
            --bg-color: #1e1e1e;
            --editor-bg: #252526;
            --border-color: #3e3e42;
            --text-color: #d4d4d4;
            --header-color: #ffffff;
            --accent-color: #007acc;
            --accent-hover: #005a9e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--editor-bg);
            flex-shrink: 0;
        }

        header h1 {
            color: var(--header-color);
            font-size: 1.5rem;
        }

        header p {
            color: var(--text-color);
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            flex-grow: 1;
            gap: 1rem;
            padding: 1rem;
            min-height: 0;
        }

        .editor-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-height: 0;
        }

        .editor-pane {
            display: flex;
            flex-direction: column;
            background-color: var(--editor-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            flex-grow: 1;
            min-height: 0;
        }

        h3 {
            padding: 0.75rem 1rem;
            background-color: #333;
            border-bottom: 1px solid var(--border-color);
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        textarea {
            flex-grow: 1;
            width: 100%;
            padding: 1rem;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            resize: none;
            outline: none;
        }

        .preview-container {
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        #live-preview {
            width: 100%;
            height: 100%;
            border: none;
            background-color: #fff;
        }

        .ai-container {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--editor-bg);
            flex-shrink: 0;
        }

        #gemini-prompt {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            border-radius: 6px;
            font-size: 1rem;
            outline: none;
        }

        #gemini-prompt:focus {
            border-color: var(--accent-color);
        }

        #gemini-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background-color: var(--accent-color);
            color: white;
            font-weight: 700;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease, opacity 0.2s ease;
        }

        #gemini-button:hover:not(:disabled) {
            background-color: var(--accent-hover);
        }

        #gemini-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            .preview-container {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Modern Live Editor</h1>
        <p>mit ✨ Gemini AI Unterstützung</p>
    </header>

    <div class="main-container">
        <div class="editor-container">
            <div class="editor-pane">
                <h3>HTML</h3>
                <textarea id="html-code" spellcheck="false"></textarea>
            </div>
            <div class="editor-pane">
                <h3>CSS</h3>
                <textarea id="css-code" spellcheck="false"></textarea>
            </div>
            <div class="editor-pane">
                <h3>JavaScript</h3>
                <textarea id="js-code" spellcheck="false"></textarea>
            </div>
        </div>
        <div class="preview-container">
            <h3>Live Vorschau</h3>
            <iframe id="live-preview"></iframe>
        </div>
    </div>

    <div class="ai-container">
        <input type="text" id="gemini-prompt" placeholder="Beschreibe deine Änderung (z.B. 'Mache den Button blau')">
        <button id="gemini-button">Mit Gemini bearbeiten</button>
    </div>

    <!-- Die gesamte Anwendungslogik -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const htmlCode = document.getElementById('html-code');
            const cssCode = document.getElementById('css-code');
            const jsCode = document.getElementById('js-code');
            const previewFrame = document.getElementById('live-preview');
            const geminiPrompt = document.getElementById('gemini-prompt');
            const geminiButton = document.getElementById('gemini-button');

            // Funktion zur Aktualisierung der Live-Vorschau
            const updatePreview = () => {
                const previewDoc = `
                    <html>
                        <head>
                            <style>${cssCode.value}</style>
                        </head>
                        <body>
                            ${htmlCode.value}
                            <script>${jsCode.value}<\/script> 
                        </body>
                    </html>
                `;
                previewFrame.srcdoc = previewDoc;
            };
            
            // Beispielcode beim Laden der Seite
            const loadExampleCode = () => {
                htmlCode.value = `<!-- Willkommen! -->
<div class="container">
  <h1>Hallo Welt!</h1>
  <p>Gib im Feld unten einen Befehl ein, um den Code mit Gemini AI zu ändern.</p>
  <button id="my-button">Klick mich!</button>
</div>`;

                cssCode.value = `body {
  font-family: sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #f0f0f0;
  color: #333;
  text-align: center;
}
button {
  padding: 10px 20px;
  font-size: 16px;
  border: 2px solid #333;
  background-color: white;
  cursor: pointer;
  border-radius: 5px;
}`;

                jsCode.value = `const button = document.getElementById('my-button');
button.addEventListener('click', () => {
  alert('Du hast den Button geklickt!');
});`;
            };

            // Event-Listener für die Code-Editoren
            [htmlCode, cssCode, jsCode].forEach(editor => {
                editor.addEventListener('input', updatePreview);
            });

            // Funktion zur Handhabung der Gemini-Anfrage
            const handleGeminiRequest = async () => {
                const promptText = geminiPrompt.value.trim();
                if (!promptText) {
                    alert('Bitte gib eine Anweisung für die KI ein.');
                    return;
                }

                // ==============================================================
                // == WICHTIG: Gib hier deinen Gemini API Schlüssel ein        ==
                // == Du erhältst ihn im Google AI Studio: https://aistudio.google.com/
                // ==============================================================
                const API_KEY = 'DEIN_GEMINI_API_SCHLUESSEL_HIER_EINFUEGEN';
                
                if (API_KEY === 'DEIN_GEMINI_API_SCHLUESSEL_HIER_EINFUEGEN') {
                    alert('Bitte ersetze "DEIN_GEMINI_API_SCHLUESSEL_HIER_EINFUEGEN" im Skript durch deinen echten Gemini API-Schlüssel.');
                    return;
                }

                geminiButton.disabled = true;
                geminiButton.textContent = 'Bearbeite...';
                
                // Der detaillierte Prompt, damit Gemini den Kontext versteht
                const promptForGemini = `
                    Du bist ein KI-Assistent für Webentwicklung. Deine Aufgabe ist es, bestehenden HTML-, CSS- und JavaScript-Code basierend auf einer Benutzeranweisung zu modifizieren.
                    Analysiere den untenstehenden Code und die Anweisung. Gib deine Antwort IMMER und AUSSCHLIESSLICH als ein einzelnes JSON-Objekt zurück, das die Schlüssel "html", "css" und "js" mit dem aktualisierten Code als String-Wert enthält. Ändere nichts, was nicht angefragt wurde.

                    Benutzeranweisung: "${promptText}"

                    Aktueller HTML-Code:
                    \`\`\`html
                    ${htmlCode.value}
                    \`\`\`

                    Aktueller CSS-Code:
                    \`\`\`css
                    ${cssCode.value}
                    \`\`\`

                    Aktueller JavaScript-Code:
                    \`\`\`javascript
                    ${jsCode.value}
                    \`\`\`
                    
                    Antworte nur mit dem JSON-Objekt. Kein einleitender Text, keine Erklärungen.
                `;

                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: promptForGemini }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API-Fehler: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    // Den reinen Text aus der Antwort extrahieren
                    let responseText = data.candidates[0].content.parts[0].text;
                    
                    // Bereinige die Antwort, falls sie in Markdown-Code-Blöcken eingeschlossen ist
                    responseText = responseText.replace(/^```json\s*/, '').replace(/```\s*$/, '');
                    
                    const parsedCode = JSON.parse(responseText);
                    
                    // Überprüfen, ob die Antwort die erwarteten Schlüssel enthält
                    if (parsedCode.html && parsedCode.css && parsedCode.js) {
                        htmlCode.value = parsedCode.html;
                        cssCode.value = parsedCode.css;
                        jsCode.value = parsedCode.js;
                        updatePreview(); // Wichtig, um die Änderungen anzuzeigen
                    } else {
                        throw new Error("Die KI-Antwort hatte ein unerwartetes Format.");
                    }

                } catch (error) {
                    console.error('Fehler bei der Gemini-Anfrage:', error);
                    alert(`Ein Fehler ist aufgetreten: ${error.message}. Bitte überprüfe die Entwicklerkonsole.`);
                } finally {
                    geminiButton.disabled = false;
                    geminiButton.textContent = 'Mit Gemini bearbeiten';
                    geminiPrompt.value = ''; // Eingabefeld leeren
                }
            };

            // Event-Listener für den Gemini-Button und die Enter-Taste
            geminiButton.addEventListener('click', handleGeminiRequest);
            geminiPrompt.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    handleGeminiRequest();
                }
            });
            
            // Editor initialisieren
            loadExampleCode();
            updatePreview();
        });
    </script>
</body>
</html>
